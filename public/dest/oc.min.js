/*! Tinyp2p 2015-11-13 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./dialog"),e=a("./security"),f={};f._send=function(a,b,c,d,g){var h={url:a,type:"GET",headers:{"Content-Type":"application/json"}};b&&(h.type=b),c&&(c=e.removeXss(c),h.data=JSON.stringify(c)),h.success=function(a){d(a)},g?h.error=function(a){404===a.status&&f.cb404&&f.cb404(),g(a)}:h.error=f.error,$.ajax(h)},f.get=function(a,b,c){this._send(a,null,null,b,c)},f.post=function(a,b,c,d){this._send(a,"post",b,c,d)},f.put=function(a,b,c,d){this._send(a,"put",b,c,d)},f["delete"]=function(a,b,c){this._send(a,"delete",null,b,c)},f.error=function(a){404===a.status&&f.cb404&&f.cb404(),d.tips("Request error:"+a.responseText.toString())},b.exports=f},{"./dialog":5,"./security":11}],2:[function(a,b,c){!function(a,c){"use strict";function d(a,b){var c=b.toString(),d=c.substring(1,c.lastIndexOf("/")),e=c.substring(c.lastIndexOf("/")+1);return-1===e.indexOf("g")&&(b=new RegExp(d,e+"g")),a.split(b)}function e(a){return""===a.replace(/^[\s]*|[\s]*$/g,"")}function f(a){var b;for(b=0;b<a.length;b++)e(a[b])&&a.splice(b--,1)}function g(a,b){var c,d,e,f;for(c=0;c<a.length;c++)if(e=a[c].replace(/^[\s]*|[\s]*$/g,""),f="",('"'===e.charAt(0)||"'"===e.charAt(0))&&(f=e.charAt(0)),""!==f&&e.slice(-1)!==f){for(d=c+1,d<a.length&&(e=a[d].replace(/^[\s]*|[\s]*$/g,""));d<a.length&&e.slice(-1)!==f;)a[c]+=b+a.splice(d,1)[0],e=a[d].replace(/[\s]*$/g,"");d<a.length&&(a[c]+=b+a.splice(d,1)[0])}}function h(a){var b;for(b=0;b<a.length;b++)a[b]=a[b].replace(/^[\s]*|[\s]*$/g,"")}function i(a){var b;for(b=0;b<a.length;b++)'"'===a[b].charAt(0)?a[b]=a[b].replace(/^"|"$/g,""):"'"===a[b].charAt(0)&&(a[b]=a[b].replace(/^'|'$/g,""))}function j(a,b){var c=a.split(b);return g(c,b),h(c),i(c),c}function k(a,b){var c,d=[];for(c=0;c<a.length;c++)d[c]=j(a[c],b);return d}function l(a){var b,c,d,e,f,g=[],h=a[0];for(b=1;b<a.length;b++)if(d=a[b],d.length>0){if(d.length>h.length)throw new SyntaxError("not enough header fields");for(e={},c=0;c<h.length;c++)f=h[c],c<d.length?e[f]=d[c]:e[f]="";g.push(e)}return g}var m={};m.parse=function(a,b,c,e){var g,h,i,j={lineEnding:/[\r\n]/,delimiter:",",ignoreEmptyLines:!0};if(""===a)throw new SyntaxError("empty input");if("undefined"!=typeof b&&(b instanceof RegExp?j.lineEnding=b:j.lineEnding=new RegExp("["+String(b)+"]","g")),"undefined"!=typeof c&&(j.delimiter=String(c)),"undefined"!=typeof e&&(j.ignoreEmptyLines=!!e),g=d(a,j.lineEnding),j.ignoreEmptyLines&&f(g),g.length<2)throw new SyntaxError("missing header");return h=k(g,j.delimiter),i=l(h)},"object"==typeof b&&b&&"object"==typeof b.exports?b.exports=m:"function"==typeof define&&define.amd?define([],function(){return m}):a.CSV=m}("undefined"!=typeof window?window:{})},{}],3:[function(a,b,c){var d=a("./dropdown"),e=function(a){this.config={container:"body",dataList:null,limited:null,showLevel:null,onlyLast:!1},this.ele=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);$(this.config.container).addClass("buSlc");var c=this;c.formatData=function(){var a={id:1,fid:0,items:[],name:"PIS",description:"",level:1},b={};b[1]=a,c.config.dataList.map(function(a){var c=a.ancestor;if(fTree=b[c],!fTree||!fTree.level)return!0;var d={id:a.descendant,fid:c,items:[],name:a.categoryName,description:a.description,level:fTree.level+1,segments:a.segments};fTree.items.push(d),b[d.id]=d}),c.treeData=a,console.log("format data",a)},c.initSelect=function(){var a=$('<div class="mixSelectWrap"><p><input class="form-control zIpt" type="text" placeholder="Search here ..." /></p></div>');c.renderTree(c.treeData,a,0),c.dropdownText=a[0].outerHTML,c.bindEvents()},c.renderTree=function(a,b,d){if(a&&!(c.config.showLevel&&d>c.config.showLevel)){var e=$("<ul></ul>");if(a&&void 0===a.length)return c.renderTree(a.items,e,1),void e.appendTo(b);for(var f=a.length,g=0;f>g;g++){var h=a[g],i=$('<li><p style="padding-left: '+15*d+'px" data-id="'+h.id+'">'+h.name+"</p></li>");i.appendTo(e),h.items&&h.items.length>0&&this.renderTree(h.items,i,d+1)}e.find("li").length>0&&(e.appendTo(b),c.config.onlyLast&&e.prev("p").addClass("disabled"))}},c.getResult=function(){var a=[];return $(c.config.container).find(".zBadge").each(function(){var b=$(this);a.push(parseInt(b.attr("data-id")))}),a},c.getResultModels=function(){var a=this.getResult(),b=[];return c.config.dataList.map(function(c){-1!==$.inArray(c.descendant,a)&&b.push(c)}),b},c.setResult=function(a,b){var d=$(c.config.container).html("");if(a&&a.length){for(var e=0;e<a.length;e++){var f=a[e];d.append('<label class="zBadge" data-id="'+f.id+'"><i class="icon-cancel-circle"></i>'+f.name+"</label>")}b&&d.find(".zBadge .icon-cancel-circle").remove()}},c.bindEvents=function(){var a=$(c.config.container);a.on("click",".zBadge .icon-cancel-circle",function(a){a.stopPropagation(),$(this).parent().remove()}).on("click",function(b){b.stopPropagation(),d.remove(a);var e=d.show(this,"",c.dropdownText),f=e.find(".mixSelectWrap>ul");a.find(".zBadge").each(function(){var a=$(this),b=this.getAttribute("data-id"),c=f.find('p[data-id="'+b+'"]').addClass("active").data("target",a);c.parent().find(">ul").hide()}),e.on("click","ul li p:not(.disabled)",function(b){var e=$(this);if(e.hasClass("active"))e.removeClass("active").data("target").remove(),e.data("target",null),e.parent().find(">ul").show();else{e.addClass("active");var f=$('<label class="zBadge" data-id="'+e.attr("data-id")+'"><i class="icon-cancel-circle"></i>'+e.html()+"</label>");if(f.appendTo(a),e.data("target",f),e.parent().find(">ul").hide().find("p").each(function(){var a=$(this).removeClass("active");a.data("target")&&a.data("target").remove(),a.data("target",null)}),c.config.limited>0){var g=a.find(".zBadge").length;g-c.config.limited>0&&a.find(".zBadge:eq("+(g-2)+")").remove(),d.remove(a)}}}).on("input",".zIpt",function(){var a=$.trim(this.value).toUpperCase();e.find("ul p").hide().each(function(){var b=$(this);-1!==b.html().toUpperCase().indexOf(a)&&(b.show(),b.parents("li").find(">p").show())})})}),$("body").off("click",".zDropdown").on("click",".zDropdown",function(a){a.stopPropagation()}),$("body").on("click",function(){d.remove(a)})},c.formatData(),c.initSelect()};b.exports=e},{"./dropdown":6}],4:[function(a,b,c){var d={};d.format=function(a,b){a.toString().indexOf("-")>0&&(a=a.toString().replace(/-/g,"/"));var c={yyyy:"year",hh:"hours",mm:"month",dd:"date",hh:"hours",MM:"minites",ss:"seconds",ms:"millSeconds"},a=new Date(a),d={year:a.getFullYear(),month:a.getMonth()+1,date:a.getDate(),hours:a.getHours(),minites:a.getMinutes(),seconds:a.getSeconds(),millSeconds:a.getMilliseconds()};b||(b="yyyy-mm-dd");for(var e in c){var f=c[e],g=d[f];g.toString().length<2&&(g="0"+g.toString()),b=b.replace(e,g)}return b},d.compare=function(a,b){"string"==typeof a&&(a=a.replace(/-/g,"/")),"string"==typeof b&&(b=b.replace(/-/g,"/"));var a=new Date(a).getTime(),b=new Date(b).getTime();return a-b},d.getWeeksByYear=function(a){var b=52,a=parseInt(a+""),c=[1994,2e3,2005,2011,2016,2022,2028,2033,2039,2044,2050,2056,2061,2067,2072,2078,2084,2089,2095,2101,2107,2112,2118,2124,2129,2135,2140,2146,2152,2157,2163,2168,2174,2180,2185,2191,2196,2203,2208,2214,2220,2225,2231,2236,2242,2248,2253,2259,2264,2270,2276,2281,2287,2292,2298,2304,2310,2316,2321,2327,2332,2338,2344,2349,2355,2360,2366,2372,2377,2383,2388,2394];return-1!==$.inArray(a,c)&&b++,b},d.getWeekString=function(a){if(a||(a=new Date),"string"==typeof a)if(a.indexOf("-")>-1)a=a.replace(/-/g,"/");else{var b=a.slice(0,4),c=a.slice(4,6),d=a.slice(6);a=b+"/"+c+"/"+d}if(a=new Date(a),11==a.getMonth()&&a.getDate()>20){var e=new Date(a);if(e.setDate(e.getDate()+6-e.getDay()),e.getFullYear()>a.getFullYear())return 100*e.getFullYear()+1}var f=new Date(a.getFullYear(),0,1),d=f.getDay();if(f.setDate(8-f.getDay()),f>a)return 100*a.getFullYear()+1;var g=Math.floor((a-f)/6048e5);return 100*a.getFullYear()+g+2},d.getStartDateByWeek=function(a){if(!a)return"";"string"==typeof a&&(a=parseInt(a));var b=Math.floor(a/100),c=a%100,d=new Date(b,0,1);return d.setDate(7*(c-1)+1-d.getDay()),d},d.getNextWeek=function(a){"string"==typeof a&&(a=a.replace(/-/g,""),a=parseInt(a));var b=Math.floor(a/100),c=a%100;return 52>c?100*b+c+1:53==c?100*(b+1)+1:52==this.getWeeksByYear(b)?100*(b+1)+1:100*b+c+1},d.weekPicker=function(a){var a=$(a),b=$.trim(a.val()),c=function(){var a=$('<table class="zWeekPicker"></table>'),c=$("<thead></thead>").appendTo(a),e=new Date;b||(b=d.getWeekString(e).toString());var f=b.slice(0,4),g=b.slice(4);c.append('<tr><th colspan="100"><i class="icon-arrow-left"></i><span class="spanYear">'+f+'</span><i class="icon-arrow-right"></i></th></tr>');for(var h=$("<tbody></tbody>").appendTo(a),i=d.getWeeksByYear(f),j=$("<tr></tr>").appendTo(h),k=0;i>k;k++){k%7===0&&(j=$("<tr></tr>").appendTo(h));var l=(k+1).toString();9>k&&(l="0"+l),j.append("<td>"+l+"</td>")}h.find("td:contains("+g+")").addClass("active");var m=d.getStartDateByWeek(f+g),n=m.getTime()+5184e5;return n=d.format(n,"mmdd"),m=d.format(m,"mmdd"),h.find("tr:last-child").append('<td colspan="10" class="zWeekPickerTag"><i class="icon-clock2"></i><span>'+m+" - "+n+"</span></td>"),a.on("click","thead i",function(b){var c=$(this),e=c.parent().find(".spanYear"),f=parseInt(e.text());c.hasClass("icon-arrow-left")?f--:f++,i=d.getWeeksByYear(f),52==i?a.find("td:contains(53)").remove():0===a.find("td:contains(53)").length&&$("<td>53</td>").insertBefore(a.find("td.zWeekPickerTag")),e.html(f)}).on("mouseenter","tbody td:not(.zWeekPickerTag)",function(){var a=this.innerHTML,b=d.getStartDateByWeek(f+a),c=b.getTime()+5184e5;c=d.format(c,"mmdd"),b=d.format(b,"mmdd"),h.find("td.zWeekPickerTag span").html(b+" - "+c)}).on("mouseleave","tbody",function(){var a=d.getStartDateByWeek(f+g),b=new Date(a).getTime()+5184e5;b=d.format(b,"mmdd"),a=d.format(a,"mmdd"),h.find("td.zWeekPickerTag span").html(a+" - "+b)}).on("click",function(a){a.stopPropagation()}),$("body").on("click",function(){a.hide()}),a.appendTo("body"),a},e=function(a){var b=$(".zWeekPicker");0===b.length&&(b=c());var d=a.position(),e=$.trim(a.val());if(e&&6===e.length){var f=e.slice(0,4),g=e.slice(4);b.find(".spanYear").html(f),b.find("td.active").removeClass("active"),b.find("td:contains("+g+")").addClass("active")}b.css({left:d.left,top:d.top+a.outerHeight(),display:"block"}),b.off("click","tbody td:not(.zWeekPickerTag)").on("click","tbody td:not(.zWeekPickerTag)",function(){b.hide();var c=b.find(".spanYear").text(),d=$(this).html(),e=c+d;a.val(e),a.change()})};a=$(a),a.on("click",function(b){b.stopPropagation(),e(a)})},b.exports=d},{}],5:[function(a,b,c){var d={};d.removeMadal=function(){this.removeAllTips(),this.close()},d.removeAllTips=function(){$(".zLoading, .tips").remove()},d.tips=function(a,b,c){void 0===b&&(b=1500),"function"==typeof b&&(c=b,b=1e3);var d=$('<div class="tips">'+a+"</div>");d.appendTo("body");var e=d.width();d.css("margin-left",-e/2+"px"),b>0?setTimeout(function(){d.remove(),c&&c()},b):(d.append('<i class="icon-close"></i>'),d.on("click","i.icon-close",function(){d.remove()}))},d.loading=function(a){this.removeMadal();var b=$('<div class="zLoading"></div><div class="tips">'+a+"</div>");b.appendTo("body");var c=$(".tips").width();return b.css("margin-left",-c/2+"px"),b},d.confirm=function(a,b,c,e){var f=$('<div class="zLoading"></div><div class="tips confirm" style="min-width: 500px;">'+a+'<div style="border-top: 1px dashed #ddd;" class="tc mt20 pt10"><button class="btn btn-info btn-sm btnOK mr20 w80">OK</button><button class="btn btn-default btn-sm btnCancel w80" style="margin-right: 0">Cancel</button></div></div>');f.appendTo("body").on("click",".btnOK, .btnCancel",function(){var a=f.find("input, textarea"),g="";if(a.length>0&&(g=a.val()),$(this).hasClass("btnOK")){if(e===!0&&a.length>0&&!g)return d.tips("message is required."),void a.focus();b&&b(g)}else c&&c(g);f.remove()}).on("click","input, textarea",function(){f.removeClass("has-error")});var g=$(".tips").width();return f.css("margin-left",-g/2+"px"),f},d.open=function(a,b,c){this.removeMadal(),b||(b=a,a="");var d=$('<div class="zDialogCover"><div class="zDialog"><p class="zDialogTitle"><span class="close">×</span>'+a+"</p></div></div>").appendTo(document.body),e=d.find(".zDialog");e.append(b);var f=e.outerWidth(),g=e.outerHeight();e.css({"margin-left":-f/2+"px",left:"50%",width:f});var h=$(document).outerHeight();e.on("click",".close",function(){e.animate({top:0,opacity:0},500,function(){d.remove()})});var i="15%";g>h&&(i="5%"),g>500&&(e.css({position:"absolute","margin-left":-f/2+$(document).scrollLeft()}),i=$(document).scrollTop()+50+"px",$(document).scroll(function(){e.css("margin-left",-f/2+$(document).scrollLeft())})),e.animate({top:i,opacity:1},500,function(){c&&c()})},d.close=function(a){var b=function(a){if(a.length){var b=a.find(".zDialog");b.animate({top:0,opacity:0},500,function(){a.remove()})}};return a?(a=$(a),void b(a.hasClass("zDialogCover")?a:a.parents(".zDialogCover"))):void b($(".zDialogCover"))},b.exports=d},{}],6:[function(a,b,c){b.exports={show:function(a,b,c,d){var a=$(a);if(!a.data("zTarget")){var e=$('<div class="zDropdown"><div class="zDropdownBd"></div></div>');if(e.find(".zDropdownBd").append(c),b){var f=$('<div class="zDropdownHd"></div>').append(b);e.prepend(f)}return e.appendTo("body"),this._setPosition(a,e,b,d),e.data("zTarget",a),a.data("zTarget",e),e}},remove:function(a){a?(a=$(a),a.hasClass("zDropdown")||(a=a.data("zTarget"))):a=$(".zDropdown"),a&&a.each&&a.each(function(){var a=$(this),b=a.data("zTarget");a.remove(),a.data("zTarget",null),b&&b.data("zTarget",null)})},_setPosition:function(a,b,c,d){var e=a.offset(),f=e.left,g=e.top,h=$(window),i={upTop:g-b.outerHeight()-8,downTop:g+a.outerHeight()+8,leftLeft:f,rightLeft:f-b.outerWidth()+a.outerWidth()},j=i.leftLeft;"right"===d&&i.rightLeft>h.scrollLeft()?(j=i.rightLeft,b.addClass("zDropdownRight")):f+b.outerWidth()>h.scrollLeft()+h.width()&&(j=i.rightLeft,b.addClass("zDropdownRight"));var k=i.downTop;if("up"===d&&i.upTop>h.scrollTop())k=i.upTop,b.addClass("zDropdownUp");else if(k+b.height()>h.outerHeight()+h.scrollTop())if(k=i.upTop,k<h.scrollTop()){var l=g-h.scrollTop(),m=h.outerHeight()-l-a.outerHeight(),n=l>m?l:m;b.css("height",n-20),c&&b.find(".zDropdownBd").css("height",n-40),m>l?k=i.downTop:(k=g-b.outerHeight()-8,b.addClass("zDropdownUp"))}else b.addClass("zDropdownUp");b.css({left:j,top:k,"min-width":a.outerWidth()})}}},{}],7:[function(a,b,c){var d=function(b){this.csv=a("./asset/csv"),this.ele=null,this._dataList=[],this.canEdit=!0,this.maxHeight=800,this.config={container:"body",canEdit:!0,maxHeight:800,heads:[]};for(var c in b)this.config.hasOwnProperty(c)&&(this.config[c]=b[c]);var d=this;d._render=function(){d.ele=$('<div class="zUploader"></div>');var a=$('<div class="zUploaderList"></div>');a.append(d._renderNoFile()),d.ele.append(a),d.ele.appendTo(d.config.container)},d._renderNoFile=function(){var a=$('<div class="zUploaderNoFile" style="padding:15px 0 0 0;"></div>');return a.append('<span class="zUploaderFileBtn "><input type="file" accept=".csv" /><span class="zUploaderBtnText">点击选择文件</span></div>'),a.append("<p>或将文件拖到这里, 暂仅支持CSV格式</p>"),a},d._bindEvent=function(){d.ele.on("change",'.zUploaderFileBtn input[type="file"]',function(){d._readFilesToTable(this.files[0])}),d.ele.find(".zUploaderNoFile")[0].addEventListener("drop",function(a){$(this).css("border","3px dashed #e6e6e6"),a.preventDefault(),d._readFilesToTable(a.dataTransfer.files[0])}),d.ele.on("dragenter",".zUploaderNoFile",function(a){a.preventDefault(),$(this).css("border","3px dashed #aaa")}).on("dragleave",".zUploaderNoFile",function(a){a.preventDefault(),$(this).css("border","3px dashed #e6e6e6")}),$(document).on({dragleave:function(a){a.preventDefault()},drop:function(a){a.preventDefault()},dragenter:function(a){a.preventDefault()},dragover:function(a){a.preventDefault()}}),d.ele.on("blur",".zFileTable tbody td input",function(){var a=this.value,b=$(this),c=b.parent(),e=c.attr("data-index"),f=e.split(","),g=f[0],h=f[1];d._dataList[g][h]=a})},d.readCsv=function(a,b){var c=new FileReader;c.onload=function(e){$('input[type="file"]').replaceWith($('<input type="file" accept=".csv">'));var f=c.result;return-1!==f.indexOf("�")?void c.readAsText(a,"GB2312"):(d._formatFileContent(f),void b())},c.readAsText(a)},d._formatFileContent=function(a){var b=d.csv.parse(a),c=b[0],e=[];for(var f in c)e.push(f);d._dataList=[],d._dataList.push(e);for(var g=0;g<b.length;g++){var h=b[g],i=[];for(var f in h)i.push(h[f]);d._dataList.push(i)}},d._readFilesToTable=function(a){d.readCsv(a,function(){$(".zFileTableContainer").remove();var a=$('<div class="zFileTableContainer"><table class="zFileTable"></table></div>');d.config.maxHeight&&a.css("max-height",d.config.maxHeight+"px");var b=a.find(".zFileTable");if(d._dataList&&d._dataList.length>0){for(var c=d._dataList[0],e=c.length,f=$("<thead></thead>"),g=$("<tbody></tbody>"),h=$("<tr><th></th></tr>").appendTo(f),i=0;e>i;i++)h.append("<th>"+c[i]+"</th>");for(var i=1;i<d._dataList.length;i++){for(var j=d._dataList[i],k=$("<tr><td>"+i+"</td></tr>"),l=0;e>l;l++)k.append('<td data-val="true", data-index="'+i+","+l+'">'+$.trim(j[l])+"</td>");g.append(k)}b.append(f),b.append(g)}var m=d.ele.find(".zUploaderList");m.find(".zFileTable").remove(),a.appendTo(m),d.setEditTable(b)})},d.setEditTable=function(a){d.config.canEdit===!0&&a.find("tbody td[data-val]").each(function(){var a=$(this),b=a.html();a.html('<span class="tdSpan">'+b+'</span><input class="tdIpt" type="text" value="'+b+'" />')})},d.getDataList=function(){var a=[];if(!d._dataList||0===d._dataList.length)return null;var b=d._dataList[0];d.config.heads&&d.config.heads.length>0&&(d.config.heads.length>b.length&&(d.config.heads=d.config.heads.slice(0,b.length)),b=b.slice(d.config.heads.length),b=d.config.heads.concat(b));for(var c=b.length,e=1;e<d._dataList.length;e++){for(var f=d._dataList[e],g={},h=0;c>h;h++)g[b[h]]=$.trim(f[h]);a.push(g)}return a},d.mark=function(a){for(var b=a.length,c=0;b>c;c++){var e=a[c],f=e.row+","+e.col,g=d.ele.find('tbody td[data-index="'+f+'"]');g.addClass("zFileTableMark").attr("title",e.msg)}},d.clearMark=function(){d.ele.find("tbody .zFileTableMark").removeAttr("title").removeClass("zFileTableMark")},d._render(),d._bindEvent()};b.exports=d},{"./asset/csv":2}],8:[function(a,b,c){var d=function(a){this.config={container:"body",remoteImg:0},this.ele=null,this.canvas=null,this.ctx=null,this.img=null,this.filter=null,this.scaleHeight=0,this.scaleWidth=0;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c.render=function(){c.ele=$('<div class="zImageCrop"></div>');var a=$('<div class="zImageCropWrap"></div>').appendTo(c.ele);a.append('<canvas class="zImageCropCanvas"></canvas>'),a.append('<span class="zImageCropCover zImageCropCoverTop"></span>'),a.append('<span class="zImageCropCover zImageCropCoverRight"></span>'),a.append('<span class="zImageCropCover zImageCropCoverLeft"></span>'),a.append('<span class="zImageCropCover zImageCropCoverBottom"></span>'),a.append('<span class="zImageCropFilter"><i class="zCutDown"></i><i class="zCutLeft"></i><i class="zCutRight"></i><i class="zCutUp"></i></span>'),c.ele.append('<div class="zImageCropControl"><span class="iptFile"><input type="file" accept="image/*">Open</span><span class="zCutRange"><b>－</b><input type="range" min="50" max="500" step="1"><b>＋</b><span class="zRangePercent">0%</span></span><span class="zCutImageSize">0 × 0</span><button class="btnCut">Cut</button></div>'),c.ele.append('<h3 class="zImageCropDropInfo mt50">Drop image here</h3>'),c.canvas=c.ele.find("canvas")[0],c.ctx=c.canvas.getContext("2d"),c.img=new Image,c.filter=c.ele.find(".zImageCropFilter"),c.ele.appendTo(c.config.container),c.config.remoteImg&&c.readFile(c.config.remoteImg),c.bindEvents()},c.supportDrop=function(){c.ele.on("dragover",function(a){a.stopPropagation(),a.preventDefault()}).on("dragenter",function(a){a.stopPropagation(),a.preventDefault(),c.ele.addClass("zImageCropDrag")}).on("dragleave",function(a){a.stopPropagation(),a.preventDefault(),c.ele.removeClass("zImageCropDrag")}),c.ele.on("drop",function(a){a.stopPropagation(),a.preventDefault(),c.ele.removeClass("zImageCropDrag");var b=a.originalEvent.dataTransfer.files;c.readFile(b[0])})},c.imgLoaded=function(){c.ele.find(".zImageCropDropInfo").hide(),c.ele.find(".zImageCropFilter").css("display","block"),c.drawImage(),c.scaleWidth=c.img.width,c.scaleHeight=c.img.height,c.ele.find(".zCutImageSize").html(c.img.width+" × "+c.img.height),c.ele.find(".zCutRange input").val(100),c.ele.find(".zRangePercent").html("100%")},c.readFile=function(a){var b=new FileReader;if(b.onload=function(a){c.img.src=this.result,c.imgLoaded()},"object"==typeof a){if(!/image\/.*/.test(a.type))return void(window.oc?oc.dialog.tips("Only image file is accept"):alert("Only image file is accept"));b.readAsDataURL(a)}else c.img.src=a,c.img.onload=c.imgLoaded},c.bindEvents=function(){c.downWidth=c.filter.width(),c.downHeight=c.filter.height(),c.downLeft=c.filter.position().left,c.downTop=c.filter.position().top,c.downPosition={};new FileReader;c.supportDrop(),c.ele.on("change",'input[type="file"]',function(){c.readFile(this.files[0])}).on("input",'.zImageCropControl input[type="range"]',function(){c.ele.find(".zImageCropControl .zRangePercent").html(this.value+"%"),c.range()}).on("click",".zImageCropControl b",function(){var a=parseInt(c.ele.find(".zImageCropControl .zRangePercent").html());"－"===this.innerHTML?(a-=10,50>a&&(a=50)):(a+=10,a>500&&(a=500)),c.ele.find(".zImageCropControl .zRangePercent").html(a+"%"),c.ele.find('.zImageCropControl input[type="range"]').val(a),c.range()}).on("click",".btnCut",c.cutImage).on("mousedown",".zImageCropFilter",function(a){1===a.which?(c.downPosition=a.originalEvent,downLeft=c.filter.position().left,downTop=c.filter.position().top,$(document).off("mousemove"),$(document).on("mousemove",function(a){c.moveFilter(a)})):(console.log("off move"),$(document).off("mousemove"))}).on("mousedown",".zImageCropFilter i",function(a){a.stopPropagation(),c.downWidth=c.filter.width(),c.downHeight=c.filter.height(),c.downLeft=c.filter.position().left,c.downTop=c.filter.position().top;var b=$(this);1===a.which?(c.downPosition=a.originalEvent,$(document).off("mousemove"),$(document).on("mousemove",function(a){c.moveFilterIcon(a,b)})):(console.log("off move"),$(document).off("mousemove"))}),$(document).on("mouseup",function(){$(document).off("mousemove")})},c.drawImage=function(){c.img.src&&(c.canvas.width=c.img.width,c.canvas.height=c.img.height,$(c.canvas).parent().css({"margin-left":c.canvas.width/-2,"margin-top":c.canvas.height/-2}),c.ctx.clearRect(0,0,c.canvas.width,c.canvas.height),c.ctx.drawImage(c.img,0,0,c.img.width,c.img.height),c.resetCover())},c.range=function(){var a=c.ele.find('.zImageCropControl input[type="range"]').val();c.canvas.width=c.scaleWidth*a/100,c.canvas.height=c.scaleHeight*a/100,$(c.canvas).parent().css({"margin-left":c.canvas.width/-2,"margin-top":c.canvas.height/-2}),c.ctx.drawImage(c.img,0,0,c.canvas.width,c.canvas.height),c.resetFilter(),c.resetCover()},c.cutImage=function(){if(c.img.src){c.ctx.clearRect(0,0,c.canvas.width,c.canvas.height);var a=c.ele.find('.zImageCropControl input[type="range"]').val()/100,b=c.filter.width(),d=c.filter.height();c.canvas.width=b,c.canvas.height=d,$(c.canvas).parent().css({"margin-left":c.canvas.width/-2,"margin-top":c.canvas.height/-2}),c.ctx.drawImage(c.img,c.filter.position().left/a,c.filter.position().top/a,b/a,d/a,0,0,b,d),c.resetFilter(),c.resetCover(),c.ele.find(".zImageCropCover").css({width:0,height:0}),c.ele.find('.zImageCropControl input[type="range"]').val(100),c.ele.find(".zImageCropControl .zRangePercent").html("100%"),c.ele.find(".zImageCropControl .zCutImageSize").html(b+" × "+d),c.scaleWidth=b/a,c.scaleHeight=d/a,c.img.src=c.canvas.toDataURL("image/png")}},c.moveFilter=function(a){var b=a.originalEvent,d=downLeft+b.clientX-c.downPosition.clientX,e=downTop+b.clientY-c.downPosition.clientY;0>d&&(d=0),0>e&&(e=0),c.resetFilter(),c.resetCover()},c.resetFilter=function(){var a=$(c.canvas).parent(),b=parseInt(a.css("margin-left"))+c.ele.width()/2,d=c.ele.width()-c.canvas.width-b,e=parseInt(a.css("margin-top"))+c.ele.height()/2,f=c.ele.height()-c.canvas.height-e;0>b?b*=-1:b=0,0>d?d*=-1:d=0,0>f?f*=-1:f=0,0>e?e*=-1:e=0,c.filter.css({width:"auto",height:"auto",left:b,right:d,top:e,bottom:f})},c.resetCover=function(){var a=c.filter.position();c.ele.find(".zImageCropCoverTop").css({height:a.top,width:"100%",left:0,top:0}),c.ele.find(".zImageCropCoverBottom").css({height:c.canvas.height-a.top-c.filter.height()-2,width:"100%",bottom:"2px",left:0}),c.ele.find(".zImageCropCoverRight").css({width:c.canvas.width-c.filter.width()-a.left,height:c.filter.height()+2,top:a.top,right:0}),c.ele.find(".zImageCropCoverLeft").css({width:a.left,height:c.filter.height()+2,top:a.top,left:0})},c.moveFilterIcon=function(a,b){a.stopPropagation();var d=a.originalEvent,e=$(b),f=e.parent(),g=d.clientX-c.downPosition.clientX,h=d.clientY-c.downPosition.clientY,i=c.downWidth+g,j=c.downHeight+h,k=$(c.canvas).parent(),l=parseInt(k.css("margin-left"))+c.ele.width()/2,m=c.ele.width()-c.canvas.width-l,n=parseInt(k.css("margin-top"))+c.ele.height()/2,o=c.ele.height()-c.canvas.height-n;if(b.hasClass("zCutRight")){var p=c.canvas.width+m-c.downLeft;0>m&&i>p?i=p:m>0&&(p=c.canvas.width-c.downLeft,i>p&&(i=p)),f.css({width:i})}else if(b.hasClass("zCutDown")){var p=c.canvas.height+o-c.downTop;0>o&&j>p?j=p:o>0&&(p=c.canvas.height-c.downTop,j>p&&(j=p)),f.css({height:j})}else b.hasClass("zCutLeft")?(0>l&&c.downLeft+l<=-1*g?g=-1*(c.downLeft+l):l>0&&c.downLeft<=-1*g&&(g=-1*c.downLeft),f.css({left:c.downLeft+g,width:c.downWidth-g+2})):b.hasClass("zCutUp")&&(0>n&&c.downTop+n<=-1*h?h=-1*(c.downTop+n):n>0&&c.downTop<=-1*h&&(h=-1*c.downTop),f.css({top:c.downTop+h,height:c.downHeight-h+2}));c.resetCover()},c.render()};b.exports=d},{}],9:[function(a,b,c){!function(){window.oc={},oc.ui=a("./ui"),oc.dialog=a("./dialog"),oc.localStorage=a("./localStorage"),oc.FileView=a("./fileView"),oc.Uploader=a("./uploader"),oc.TreeSelect=a("./treeSelect"),oc.BUSelect=a("./buSelect"),oc.TreeDialogSelect=a("./treeDialogSelect"),oc.Tree=a("./tree"),oc.ImageCrop=a("./imageCrop"),oc.Sidebar=a("./sidebar"),oc.TreeOrganization=a("./treeOrganization"),oc.TreePIS=a("./treePIS"),oc.ajax=a("./ajax"),oc.date=a("./date");var b=$("script[data-occss]").attr("data-occss");b?($("<link>").attr({rel:"stylesheet",type:"text/css",href:b}).appendTo("head"),b=b.replace("oc.css","icons/style.css"),$("<link>").attr({rel:"stylesheet",type:"text/css",href:b}).appendTo("head")):($("<link>").attr({rel:"stylesheet",type:"text/css",href:"http://res.laptopmate.us/webapp/js/oc/oc.css"}).appendTo("head"),$("<link>").attr({rel:"stylesheet",type:"text/css",href:"http://res.laptopmate.us/webapp/js/oc/icons/style.css"}).appendTo("head"))}()},{"./ajax":1,"./buSelect":3,"./date":4,"./dialog":5,"./fileView":7,"./imageCrop":8,"./localStorage":10,"./sidebar":12,"./tree":13,"./treeDialogSelect":14,"./treeOrganization":15,"./treePIS":16,"./treeSelect":17,"./ui":18,"./uploader":19}],10:[function(a,b,c){var d={storage:window.localStorage};d.set=function(a,b){if("string"!=typeof a)return void console.error("key mast to be a string");var c=JSON.stringify(b);this.storage[a]=c},d.get=function(a){if("string"!=typeof a)return console.error("key mast to be a string"),null;var b=this.storage[a]||null,c=JSON.parse(b);return c},d.remove=function(a){this.storage.removeItem(a)},d.clear=function(){this.storage.clear()},b.exports=d},{}],11:[function(a,b,c){var d={};d.removeXss=function(a){for(var b in a){var c=a[b];if(c)if("string"==typeof c)a[b]=c.replace(/</g,"&lt;").replace(/>/g,"&gt;");else if("object"==typeof c&&c.length)for(var e=0;e<c.length;e++){var f=c[e];d.removeXss(f)}else"object"==typeof c&&d.removeXss(c)}return a},b.exports=d},{}],12:[function(a,b,c){var d=function(a,b){this.container=b,this.dataList=a;var c=this;c._render=function(){var a=$('<aside class="zSideBar"><ul class="zSideBarUl"></ul></aside>'),d=a.find("ul");c.dataList.map(function(a){var b=$("<li><a>"+a.name+"</a></li>");if(b.appendTo(d),a.hash&&b.find(">a").attr("href",a.hash),a.children){b.addClass("hasMore").append("<ul></ul>");var c=b.find("ul");a.children.map(function(a){var b=$("<li><a>"+a.name+"</a></li>");b.appendTo(c),a.hash&&b.find(">a").attr("href",a.hash)})}}),a.appendTo($(b))},c._render()};b.exports=d},{}],13:[function(a,b,c){var d=function(a){this.config={container:"body",data:null,showLevel:1},this.ele=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c.render=function(){c.ele=$('<ul class="zTree"></ul>');var a=$('<li class="zTreeItem"><p>'+c.config.data.name+"</p></li>").data(c.config.data);a.appendTo(c.ele),c._renderRecusive(c.config.data.items,a,0),$(this.config.container).find(".zTree").remove(),$(this.config.container).append(c.ele),c._bindEvents()},c.filter=function(a){c.removeFilterTag(),a&&(a=a.toUpperCase(),c.ele.find(".zTreeItem:gt(0)").removeClass("active").each(function(){var b=$(this),c=b.find(">p").html().toUpperCase();0===c.indexOf(a)&&(b.parents(".zTreeItem").addClass("active"),b.addClass("treeTag"))}))},c.removeFilterTag=function(){c.ele.find(".treeTag").removeClass("treeTag")},c._renderRecusive=function(a,b,d){if(a){var e=a.length;e>0&&b.addClass("hasMore"),d<this.config.showLevel&&b.addClass("active");for(var f=$("<ul></ul>"),g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeItem" draggable="true"><p>'+h.name+"</p></li>");h.description&&i.addClass("zTreeItemDes").find(">p").attr("title",h.description).append('<span class="spanDesc"> - '+h.description+"</span>"),i.appendTo(f).data(h),h.items&&h.items.length>0&&c._renderRecusive(h.items,i,d+1)}e>0&&f.appendTo(b)}},c._bindEvents=function(){c.ele.on("click",".zTreeItem p",function(){$(this).parent().toggleClass("active")}).on("mouseenter",".zTreeItem p",function(){$('<span class="zTreeControl"><i class="icon-plus2"></i><i class="icon-cog"></i><i class="icon-minus2 none"></i></span>').hide().appendTo(this).fadeIn(1e3)}).on("mouseleave",".zTreeItem p",function(){$(this).find(".zTreeControl").remove()}).on("click",".icon-minus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)"),d=b.parent(),e=b.data();if(!e||!e.id)return void b.fadeOut(500,function(){b.remove(),0===d.find(".zTreeItem").length&&d.remove()});var f=b.data().id;c.deleteNode(f,function(){b.fadeOut(500,function(){b.remove(),0===d.find(".zTreeItem").length&&d.remove()})})}).on("click",".icon-cog",function(a){a.stopPropagation();var b=$(this).parent().parent();b.addClass("zTreeEdit"),b.html('<input type="text" name="name" placeholder="name"><input type="text" name="description" placeholder="category, separate by dot or space"><i class="iconRight icon-checkmark"></i>');var c=b.parent().data();b.find('[name="name"]').val(c.name),b.find('[name="description"]').val(c.description)}).on("click",".zTreeEdit input, .zTreeEdit i, .zTreeControl",function(a){a.stopPropagation()}).on("click",".icon-checkmark",function(a){a.stopPropagation();var b=$(this);b.removeClass("icon-checkmark").addClass("zLoadingIcon");var d=b.parents(".zTreeItem:eq(0)").removeClass("zTreeItemDes"),e=d.data();if(!e||!e.id){e={};var f=d.parents(".zTreeItem:eq(0)").data();e.fid=f.id,e.level=parseInt(f.level)+1}e.name=d.find('[name="name"]').val(),e.description=d.find('[name="description"]').val();var g=function(a){return a===!1?void b.removeClass("zLoadingIcon").addClass("icon-checkmark"):(d.parents(".zTreeItem").addClass("hasMore"),d.data(e).find(">p").html(e.name).removeClass("zTreeEdit zTreeAdd"),
void(e.description&&d.addClass("zTreeItemDes").find(">p").attr("title",e.description).append('<span class="spanDesc"> - '+e.description+"</span>")))};e.id?c.updateNode(e,g):c.addNode(e,g)}).on("click",".icon-plus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)").addClass("active"),c=b.find(">ul");0===c.length&&(c=$("<ul></ul>").appendTo(b));var d=$('<li class="zTreeItem"></li>');d.append('<p class="zTreeEdit zTreeAdd"><input type="text" name="name" placeholder="name"><input type="text" name="description" placeholder="category, separate by dot or space"><i class="iconRight icon-checkmark"></i></p>'),d.appendTo(c)}).on("dragstart",".zTreeItem[draggable]",function(a){a.stopPropagation(),c.dragEle=$(this),a.originalEvent&&a.originalEvent.dataTransfer&&a.originalEvent.dataTransfer.setData("dragEle",a.target)}).on("dragenter",".zTreeItem>p",function(a){a.stopPropagation(),a.preventDefault();var b=$(this),d=b.parent(),e=c.dragEle.data(),f=d.data(),g=e.id,h=f.id;(h!=g||e.level!=f.level)&&(d.data().fid==c.dragEle.data().fid||h==c.dragEle.data().fid)&&d.addClass("treeTag")}).on("dragleave",".zTreeItem>p",function(a){c.timer&&clearTimeout(c.timer),a.stopPropagation(),$(this).parent().removeClass("treeTag")}).on("dragover",".zTreeItem.treeTag",function(a){a.preventDefault()}).on("drop",".zTreeItem.treeTag",function(a){var b=$(this),d=c.dragEle.data(),e=b.data(),f=d.id,g=e.id;d.fid==g&&(g=0),c.moveNode(f,g,function(a,d){b.removeClass("treeTag"),a?0==g?b.find(">ul").prepend(c.dragEle):c.dragEle.insertAfter(b):oc.dialog.tips(d)}),a.stopPropagation(),a.preventDefault()})},c.moveNode=function(a,b,c){c(!0)},c.deleteNode=function(a,b){b()},c.updateNode=function(a,b){setTimeout(b,2e3)},c.addNode=function(a,b){setTimeout(b,2e3)},c.render()};b.exports=d},{}],14:[function(a,b,c){var d=function(a,b){this.ele=$(a),this.valueChangeHanlder=null,this.dialogPanel=$('<div class="treeDialogSelect"></div>'),this.dataList=b,this.productLine=null,this.keyword="",this.canSelectedFolder=!1;var c=this;c._render=function(){c.dialogPanel.append('<div class="borderBottom pb10 pl10"><span style="padding-right:58px;">Search:</span><input id="txtKeyword" type="text" class="ipt w200"><span class="ml20 f12 spanInfo" style="color:#888"><i class="icon-info mr5" style="color:#eea236;"></i>eg:Search to the items and it\'s children. </span></div>'),c.canSelectedFolder&&c.dialogPanel.find(".spanInfo").append(" Double click to select the folder.");for(var a=$('<ul class="ulResposible ulData"><li class="liTitle">Resposibles:</li></ul>'),b=[],d=0;d<c.dataList.length;d++){var e=c.dataList[d],f=$('<li class="liFolder">'+e.name+"</li>").data(e);f.appendTo(a),e.items&&e.items.map(function(a){var c=a.description;if(!c)return!0;for(var d=c.split(/[\s|,]/g),e=0;e<d.length;e++)-1===$.inArray(d[e],b)&&b.push(d[e])})}b.sort();var g=$('<ul class="ulProductLine"><li class="liTitle">Product Lines:</li></ul>');b.map(function(a){g.append("<li>"+a+"</li>")}),c.productLine&&g.find("li:contains("+c.productLine+")").addClass("active"),g.appendTo(c.dialogPanel),a.appendTo(c.dialogPanel),c._bindEvents()},c._setSelected=function(){var a=c.ele.data("selectedList");a&&a.length>0&&a.map(function(a){var b=$(".zDialog .ulData:last"),d=b.find("li:eq("+a.eleIndex+")").addClass("active");c._renderChild(b,d)})},c._renderChild=function(a,b){var d=b.data();if(d.items&&d.items.length){var e=$('<ul class="ulData"><li class="liTitle">Children:</li></ul>');d.items.map(function(b){var d=$('<li title="'+b.name+'">'+b.name+"</li>").data(b);b.items&&0!==b.items.length?d.addClass("liFolder"):d.addClass("liData"),e.append(d),c.productLine&&a.hasClass("ulResposible")&&b.description&&-1===b.description.indexOf(c.productLine)&&d.hide()}),a.after(e),d.items&&d.items.length>0&&c._needFilter(b)&&c.filter(e.find("li"))}},c._needFilter=function(a){var b=a.parent().prevAll(".ulData").find("li.active");b=a.add(b);var d=!1;return b.each(function(){var a=$(this),b=a.data(),e=b.name.toUpperCase();return b.description&&c.productLine&&-1===b.description.indexOf(c.productLine)?!0:c.keyword&&0!==e.indexOf(c.keyword)?!0:(d=!0,!1)}),!d},c._bindEvents=function(){c.ele.off("click").on("click",function(){c.dialogPanel.html(""),c._render(),c.keyword=null,oc.dialog.open("",c.dialogPanel,function(){c._setSelected()}),c.dialogClickHanlder()})},c.filter=function(a){a||(a=$("ul.ulData li")),a.each(function(){var a=$(this).show();if(a.hasClass("liTitle"))return!0;var b=a.data();if(b.description){var d=c.productLine.split(";");if(d.length>1){var e=!1;if(d.map(function(a){a=$.trim(a),a&&-1!==b.description.indexOf(a)&&(e=!0)}),e===!1)return a.hide(),!0}else if(c.productLine&&-1===b.description.indexOf(c.productLine))return a.hide(),!0}var f=b.name.toUpperCase();c.keyword&&0!==f.indexOf(c.keyword)&&(c.filterChildren(b.items)||a.hide())})},c.filterChildren=function(a){var b=!1,d=function(a){if(!a||0===a.length)return b;if(b===!0)return b;for(var e=0;e<a.length;e++){if(b===!0)return!0;var f=a[e],g=!0,h=f.name.toUpperCase();if(f.description&&c.productLine&&-1===f.description.indexOf(c.productLine)?g=!1:c.keyword&&0!==h.indexOf(c.keyword)&&(g=!1),g===!0)return b=!0,!0;d(f.items)}};return d(a),b},c.selectedHanlder=function(a){var b=$(this);if(!b.hasClass("liFolder")||c.canSelectedFolder){var d=b.data();d.eleIndex=b.index(),c.ele.data("selectedItem",d);var e=b.parent(),f=[];e.prevAll("ul.ulData").each(function(){var a=$(this).find("li.active");a.data().eleIndex=a.index(),f.push(a.data())}),f.reverse(),f.push(d),c.ele.data("selectedList",f),c.ele.val(this.innerHTML),oc.dialog.close()}},c.dialogClickHanlder=function(){$(".zDialog").on("click","li.liFolder",function(){var a=$(this),b=a.parent();b.find(".active").removeClass("active"),a.addClass("active"),b.nextAll(".ulData").remove(),c._renderChild(b,a)}).on("dblclick","li.liFolder",c.selectedHanlder).on("click","li.liData",c.selectedHanlder).on("click",".ulProductLine li:gt(0)",function(){var a=$(this);return a.hasClass("active")?(a.removeClass("active"),c.productLine=null,void $(".zDialog .ulData:eq(1) li").show()):(a.parent().find(".active").removeClass("active"),a.addClass("active"),c.productLine=a.html(),void c.filter())}).on("input","#txtKeyword",function(){c.keyword=$.trim(this.value).toUpperCase(),c.filter()})},c.setSelectedByIds=function(a){var b=[],d=null;a&&a.length||c.ele.html("");for(var e=$.extend([],c.dataList),f=0;f<a.length;f++){var g=a[f];if(!g)break;for(var h=null,i=0;i<e.length;i++){var j=e[i];if(j.id==g){h=j;break}}if(!h)break;h.eleIndex=i+1,e=$.extend([],h.items),b.push(h),d=h}var k="";d&&(k=d.name),c.ele.data("selectedList",b),c.ele.data("selectedItem",d),c.ele.val(k)},c._render()};b.exports=d},{}],15:[function(a,b,c){var d=function(a){this.config={container:"body",data:null,teamData:null,showLevel:1,family:null,allUser:null,isShowAdmin:!1},this.allUserName=null,this.ele=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c.config.allUser&&(c.allUserName=[],c.config.allUser.map(function(a){c.allUserName.push(a.fullName)})),c.render=function(){c.ele=$('<ul class="zTree zTreeOrganization"></ul>');var a=$('<li class="zTreeItem zTreeItemFolder"><p><span class="pName">海翼电商</span></p></li>');a.appendTo(c.ele),c._renderRecusive(c.config.data.children,a,0),c.ele.find(">li>ul>li").removeAttr("draggable"),c.ele.appendTo($(this.config.container)),c.resetShowName(),c._bindEvents()},c._renderRecusive=function(a,b,d){if(a){var e=a.length;e>0&&b.addClass("hasMore"),d<this.config.showLevel&&b.addClass("active");for(var f=$("<ul></ul>"),g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeItem" draggable="true" data-type="'+h.nodeType+'"><p><span class="pName">'+h.name+"</span></p></li>");30===h.nodeType&&i.removeAttr("draggable"),10==h.nodeType||1==h.nodeType||2==h.nodeType?i.addClass("zTreeItemFolder"):21==h.nodeType&&i.addClass("zTreeItemReport"),0!==h.status&&i.find("p").addClass("lineThrough"),h.childrenCount&&21===h.nodeType&&i.find("p").append('<span class="treeCount">'+h.childrenCount+"</span>"),!h.userCount||1!==h.nodeType&&2!==h.nodeType||i.find("p").append('<span class="treeCountMember">'+h.userCount+"</span>"),i.appendTo(f).data(h),h.children&&h.children.length>0&&c._renderRecusive(h.children,i,d+1)}e>0&&f.appendTo(b)}},c.resetShowName=function(){c.ele.find("li.zTreeItem>p").each(function(){var a=$(this),b=a.parent(),d=b.data();if(!d||!d.nodeType)return!0;var e=d.nodeType;if(10===e){var f=d.name,g=c.config.teamData.filter(function(a){return a.id==f});0==g.length?b.html('<p><span class="pName">未知部门</span></p>'):(g=g[0],d.addOn=g,a.find(".pName").html(g.name))}else if(21===e||11===e){var h=b.data().name,i=c.config.allUser.filter(function(a){return a.name==h});i.length>0&&(d.addOn=i[0],a.find(".pName").html(i[0].fullName))}})},c.filter=function(a){c.removeFilterTag(),a&&(a=a.toUpperCase(),c.ele.find(".zTreeItem:gt(0)").removeClass("active").each(function(){var b=$(this),c=b.find(">p>.pName").text().toUpperCase();0===c.indexOf(a)&&(b.parents(".zTreeItem").addClass("active"),b.addClass("treeSearch"))}))},c.removeFilterTag=function(){c.ele.find(".treeSearch").removeClass("treeSearch")},c._bindEvents=function(){c.ele.on("click",".zTreeItem p",function(){var a=$(this).parent();a.toggleClass("active")}).on("mouseenter",".zTreeItem p",function(){$('<span class="zTreeControl"><i class="icon-plus2"></i><i class="icon-cog"></i><i class="icon-minus2"></i></span>').hide().appendTo(this).fadeIn(1e3)}).on("mouseleave",".zTreeItem p",function(){$(this).find(".zTreeControl").remove()}).on("click",".icon-minus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)"),d=b.parent(),e=b.data();c.deleteNode(e,function(){b.fadeOut(500,function(){b.remove(),0===d.find(".zTreeItem").length&&d.remove()})})}).on("click",".icon-cog",function(a){a.stopPropagation();var b=$(this).parent().parent(),d=b.parent(),e=d.data();c.model=e,c.dialogEdit(d)}).on("click",".zTreeEdit input, .zTreeEdit i, .zTreeControl",function(a){a.stopPropagation()}).on("click",".icon-plus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)").addClass("active");c.model=null,c.parentModel=b.data(),c.dialog(b)}).on("dragstart",".zTreeItem[draggable]",function(a){a.stopPropagation(),c.dragEle=$(this),a.originalEvent&&a.originalEvent.dataTransfer&&a.originalEvent.dataTransfer.setData("dragEle",a.target)}).on("dragenter","ul",function(a){a.stopPropagation(),a.preventDefault()}).on("dragenter",".zTreeItemFolder>p>span, .zTreeItemReport>p>span",function(a){a.stopPropagation(),a.preventDefault();var b=$(this),d=b.parents("li:eq(0)"),e=c.dragEle.data(),f=d.data(),g=e.id,h=f.id;if(g!=h&&!d.hasClass("zTree")&&h!=c.dragEle.parents("li:eq(0)").data().id&&f.familyName==e.familyName){var i=d.parents("li"),j=!0;i.each(function(){var a=$(this).data().id;a==g&&(j=!1)}),j&&(d.addClass("treeTag"),c.timer=setTimeout(function(){d.addClass("active")},1500))}}).on("dragenter",".zTreeItem",function(a){a.stopPropagation(),a.preventDefault();var b=$(this),d=c.dragEle.data(),e=b.data(),f=d.id,g=e.id;if(f!=g&&e.familyName==d.familyName){var h=c.dragEle.parents("li:eq(0)").data().id;(h===b.parents("li:eq(0)").data().id||h==g)&&b.addClass("treeTagSort")}}).on("dragleave",".zTreeItem",function(a){a.stopPropagation();var b=$(this);b.removeClass("treeTagSort")}).on("dragleave",".zTreeItem>p>span",function(a){a.stopPropagation(),c.timer&&clearTimeout(c.timer);var b=$(this).parents("li:eq(0)");b.hasClass("treeTag")&&b.removeClass("treeTag")}).on("dragover",".zTreeItem",function(a){a.preventDefault()}).on("drop",".zTreeItemFolder.treeTag, .zTreeItemReport.treeTag",function(a){var b=$(this),d=c.dragEle.data(),e=b.data(),f=d.id,g=e.id;c.moveNode(f,g,function(a,e){if(b.removeClass("treeTag"),a){var f=b.find(">ul");0==f.length&&(f=$("<ul></ul>").appendTo(b)),b.addClass("hasMore");var h=c.dragEle.parents("ul:eq(0)");d.parentId=g,c.dragEle.data(d),c.dragEle.appendTo(f),0===h.find("li").length&&(h.parent().removeClass("hasMore"),h.remove())}else oc.dialog.tips(e)}),a.stopPropagation(),a.preventDefault()}).on("drop",".zTreeItem.treeTagSort",function(a){var b=$(this),d=c.dragEle.data(),e=b.data(),f=d.id,g=e.id;c.dragEle.parents("li:eq(0)").data().id==g&&(g=null),c.sortNode(f,g,function(a,d){b.removeClass("treeTagSort"),a?null==g?b.find(">ul").prepend(c.dragEle):c.dragEle.insertAfter(b):oc.dialog.tips(d)}),a.stopPropagation(),a.preventDefault()})},c.dialogEdit=function(a){var b='<div class="formOrganization"><p class="mt10 divPerson"><span>Name: </span><input type="text" class="form-control input-sm" name="name" autocomplete="off" value="'+a.find(">p>.pName").text()+'"></p><div class="dialogBottom"><button class="btn btn-primary w100 mr20 btnSub">Save</button><button class="btn btn-default w100 ml20" onclick="oc.dialog.close();">Cancel</button></div>';10===c.model.nodeType&&(b='<div class="formOrganization"><a class="jsAddTeam" href="#">Add a team</a><p class="mt10 divGroup"><span class="mt10">Name: </span><select class="slcDepartmentType form-control input-sm" name="departmentType" style="width:120px !important"></select><select class="slcDepartment form-control input-sm" name="name" style="width:280px !important"></select></p><div class="dialogBottom"><button class="btn btn-primary w100 mr20 btnSub">Save</button><button class="btn btn-default w100 ml20" onclick="oc.dialog.close();">Cancel</button></div>'),oc.dialog.open("Edit",b);var d=$(".zDialog");if(10===c.model.nodeType){var e=d.find('[name="name"]'),f=d.find('[name="departmentType"]');c.config.teamData.map(function(a){e.append('<option value="'+a.id+'">'+a.name+"</option>"),a.type&&0===f.find('option:contains("'+a.type+'")').length&&f.append("<option>"+a.type+"</option>")}),e.find('option[value="'+c.model.name+'"]').attr("selected",!0),f.find('option:contains("'+c.model.addOn.type+'")').attr("selected",!0),f.on("change",function(){e.html("");var a=this.value;c.config.teamData.map(function(b){b.type==a&&e.append('<option value="'+b.id+'">'+b.name+"</option>")})})}if(1!==c.model.nodeType&&2!==c.model.nodeType)oc.ui.autoComplete(d.find('[name="name"]'),c.allUserName);else{var g=$('<p><span class="w100">Forbid Team:</span><input type="checkbox" name="forbidTeam" class="zToggleBtnSm"></p><p class="mb10"><span class="w100">Allow Dup:</span><input type="checkbox" name="allowDup" class="zToggleBtnSm"></p>');d.find(".divPerson").prepend(g),d.find('[name="forbidTeam"]').prop("checked",1===c.model.forbidTeam),d.find('[name="allowDup"]').prop("checked",1===c.model.allowDup),oc.ui.toggleBtn("YES","NO")}d.on("click",".btnSub",function(){var b=$(this);if(!c.checkDialogName(d))return!1;var e=null;if(21===c.model.nodeType||11===c.model.nodeType?(e=c.getUserByFullName(c.model.name),c.model.name=e.name):10===c.model.nodeType&&(e=c.getTeamById(c.model.name)),b.html('<i class="zLoadingIcon mr5"></i>').attr("disabled",!0),1===c.model.nodeType||2===c.model.nodeType){c.model.forbidTeam=$('[name="forbidTeam"]').prop("checked")?1:0,c.model.allowDup=$('[name="allowDup"]').prop("checked")?1:0;var f={familyName:c.model.familyName,name:c.model.name,forbidTeam:c.model.forbidTeam,allowDup:c.model.allowDup};return void oc.ajax.put("/product/rest/v1/user_groups/family",f,function(b){oc.dialog.close(),c.model.name=f.name,c.model.forbidTeam=f.forbidTeam,c.model.allowDup=f.allowDup,a.find(">p>.pName").html(c.model.name).data(c.model)},function(a){oc.dialog.tips("Edit node fail:"+a.responseText),b.removeAttr("disabled").html("Save")})}var f=$.extend(c.model,{});f.type&&delete f.type,f.addOn&&delete f.addOn,c.updateNode(c.model,function(d,f){if(d){oc.dialog.close(),c.model.addOn=e;var g=a.find(">p>.pName").html(e.fullName||e.name);e.img&&g.parent().addClass("pImg").append('<img src="'+img+'" />'),a.data(c.model)}else b.removeAttr("disabled").html("Save"),oc.dialog.tips("Edit node fail:"+f)})}).on("click",".jsAddTeam",function(b){b.preventDefault(),c.showTeamPanel(function(b){c.dialogEdit(a),$(".zDialogCover .slcDepartment").val(b.id),$(".zDialogCover .departmentType").val(b.type)})})},c.checkDialogName=function(a){var b=this,c=a.find('[name="name"]:visible');return b.model.name=$.trim(c.val()),b.model.name?!0:(oc.dialog.tips("Name is required"),c.focus(),!1)},c.getUserByFullName=function(a){var b=c.config.allUser.filter(function(b){return b.fullName==a});return b.length>0?b[0]:null},c.getTeamById=function(a){var b=c.config.teamData.filter(function(b){return b.id==a});return b.length>0?b[0]:null},c.dialog=function(a){var b='<div class="formOrganization"><a class="jsAddTeam" href="#">Add a team</a><div class="p15"><p class="pType"><span>Type: </span><label class="mr30"><input type="radio" name="addType" value="person" checked style="margin-right:5px">人员</label><label><input name="addType" style="margin-right:5px" type="radio" value="group">团队</label></p><p class="mt10 divPerson"><span>Name: </span><input type="text" class="form-control input-sm" name="name" autocomplete="off"></p><p class="mt10 divGroup none"><span>Name: </span><select class="slcDepartmentType form-control input-sm" name="departmentType" style="width:120px !important"></select><select class="slcDepartment form-control input-sm" name="name" style="width:280px !important"></select></p><div class="dialogBottom"><button class="btn btn-primary w100 mr20 btnSub">Add</button><button class="btn btn-default w100 ml20" onclick="oc.dialog.close();">Cancel</button></div>';oc.dialog.open("Add",b);var d=$(".zDialog"),e=a.data();if(c.model={parentId:c.parentModel.id,familyName:c.parentModel.familyName},(2==e.nodeType||21==e.nodeType)&&(c.model.nodeType=21,d.find(".pType, .divGroup, .jsAddTeam").remove()),e.nodeType){oc.ui.autoComplete(d.find('.divPerson [name="name"]'),c.allUserName);var f=d.find('.divGroup [name="name"]'),g=d.find('[name="departmentType"]');c.config.teamData.map(function(a){f.append('<option value="'+a.id+'">'+a.name+"</option>"),a.type&&0===g.find('option:contains("'+a.type+'")').length&&g.append("<option>"+a.type+"</option>")}),g.on("change",function(){f.html("");var a=this.value;c.config.teamData.map(function(b){b.type==a&&f.append('<option value="'+b.id+'">'+b.name+"</option>")})}),d.on("change",'[name="addType"]',function(){"group"===this.value?($(".divGroup").show(),$(".divPerson").hide()):($(".divPerson").show(),$(".divGroup").hide())})}else{d.find(".pType, .jsAddTeam").remove();var h='<p><span class="w100 mt10">Forbid Team:</span><input type="checkbox" name="forbidTeam" class="zToggleBtnSm"></p><p><span class="w100 mt10 mb10">Allow Dup:</span><input type="checkbox" name="allowDup" class="zToggleBtnSm"></p>';d.find(".divPerson").prepend(h),oc.ui.toggleBtn("YES","NO")}d.on("click",".btnSub",function(){var b=$(this);if(!c.checkDialogName(d))return!1;if(!e.nodeType)return c.model={name:c.model.name,forbidTeam:$('[name="forbidTeam"]').prop("checked")?1:0,allowDup:$('[name="allowDup"]').prop("checked")?1:0},void oc.ajax.post("/product/rest/v1/user_groups/family",c.model,function(b){var d=a.find(">ul");0===d.length&&(d=$("<ul></ul>").appendTo(a));var e=$('<li class="zTreeItem zTreeItemFolder"><p><span class="pName">'+c.model.name+'</span><span class="treeCountMember">0</span></p></li>');c.model.familyName=b,0===c.model.forbidTeam?c.model.nodeType=1:c.model.nodeType=2,e.data(c.model),e.appendTo(d),oc.dialog.close(),oc.dialog.tips("Add success.")});if(2!==c.model.nodeType&&21!==c.model.nodeType){var f=$('[name="addType"]:checked').val();"person"==f?c.model.nodeType=11:c.model.nodeType=10}else c.model.nodeType=21;var g=null;21===c.model.nodeType||11===c.model.nodeType?(g=c.getUserByFullName(c.model.name),c.model.name=g.name):g=c.getTeamById(c.model.name);var h=b.html();b.html('<i class="zLoadingIcon mr5"></i>'+h+"...").attr("disabled",!0),c.addNode(c.model,function(d,e){if(d){oc.dialog.close();var f=a.find(">ul");0===f.length&&(f=$("<ul></ul>").appendTo(a)),c.model.id=e;var i=$('<li class="zTreeItem" draggable="true" data-type="'+c.model.nodeType+'"><p><span class="pName">'+(g.fullName||g.name)+"</span></p></li>");if(10==c.model.nodeType)i.addClass("zTreeItemFolder");else if(21==c.model.nodeType){i.addClass("zTreeItemReport");var j=f.parents(".zTreeItem:eq(0)").find(">p>.treeCount"),k=parseInt(j.html())||0;j.html(++k)}if(c.model.addOn=g,11==c.model.nodeType||21==c.model.nodeType){var l=g.img;l&&i.find(">p").addClass("pImg").append('<img src="'+l+'" />');var j=f.parents('.zTreeItem[data-type="1"], .zTreeItem[data-type="2"]').find(".treeCountMember"),k=parseInt(j.html())||0;k++,j.html(k)}i.data(c.model),i.appendTo(f)}else b.removeAttr("disabled").html(h),oc.dialog.tips("Add node fail:"+e)})}).on("click",".jsAddTeam",function(b){b.preventDefault(),c.showTeamPanel(function(b){c.dialog(a),$('.zDialog [name="addType"]').get(1).checked=!0,$(".zDialog .divGroup").fadeIn(),$(".zDialog .divPerson").fadeOut(),$(".zDialogCover .slcDepartment").val(b.id)})})},c.deleteNode=function(a,b){b()},c.updateNode=function(a,b){setTimeout(b,2e3)},c.addNode=function(a,b){console.log(a),setTimeout(b,2e3)},c.moveNode=function(a,b,c){setTimeout(function(){c(!0)},2e3)},c.sortNode=function(a,b,c){setTimeout(function(){c(!0)},2e3)},c.showTeamPanel=function(){},c.render()};b.exports=d},{}],16:[function(a,b,c){var d=function(a){this.config={container:"body",data:null,showLevel:1},this.ele=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c.config.allUser&&(c.allUserName=[],c.config.allUser.map(function(a){c.allUserName.push(a.name)})),c.render=function(){c.ele=$('<ul class="zTree"></ul>');var a=$('<li class="zTreeItem"><p>'+c.config.data.name+"</p></li>").data(c.config.data);a.appendTo(c.ele),c._renderRecusive(c.config.data.items,a,0),$(this.config.container).find(".zTree").remove(),$(this.config.container).append(c.ele),c._bindEvents()},c.filter=function(a){c.removeFilterTag(),a&&(a=a.toUpperCase(),c.ele.find(".zTreeItem:gt(0)").removeClass("active").each(function(){var b=$(this),c=b.find(">p").html().toUpperCase();0===c.indexOf(a)&&(b.parents(".zTreeItem").addClass("active"),b.addClass("treeSearch"))}))},c.removeFilterTag=function(){c.ele.find(".treeSearch").removeClass("treeSearch")},c._renderRecusive=function(a,b,d){if(a){var e=a.length;e>0&&b.addClass("hasMore"),d<this.config.showLevel&&b.addClass("active");for(var f=$("<ul></ul>"),g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeItem" draggable="true" data-level="'+h.level+'"><p>'+h.name+"</p></li>");h.description&&i.addClass("zTreeItemDes").find(">p").attr("title",h.description),i.appendTo(f).data(h),h.items&&h.items.length>0&&c._renderRecusive(h.items,i,d+1)}e>0&&f.appendTo(b)}},c._bindEvents=function(){c.ele.on("click",".zTreeItem p",function(){var a=$(this).parent();a.toggleClass("active")}).on("mouseenter",".zTreeItem p",function(){var a=$(this);$('<span class="zTreeControl"><i class="icon-plus2" title="Add"></i><i class="icon-cog" title="Setting"></i><i class="icon-align-justify" title="Show MN list"></i></span>').hide().appendTo(this).fadeIn(1e3),a.hasClass("zTreeAdd")&&a.find(".icon-align-justify").removeClass("icon-align-justify").addClass("icon-minus2")}).on("mouseleave",".zTreeItem p",function(){$(this).find(".zTreeControl").remove()}).on("click",".icon-cog",function(a){a.stopPropagation(),$(".treeRightContainer").removeClass("active");var b=$(this).parent().parent(),d=b.parent(),e=d.data();if(e.level<4)b.addClass("zTreeEdit"),b.html('<input type="text" name="name" placeholder="name"><input type="text" name="description" placeholder="category, separate by dot or space"><i class="iconRight icon-checkmark" title="Save"></i>'),b.find('[name="name"]').val(e.name),b.find('[name="description"]').val(e.description);else if(4===e.level)$.get("/product/rest/v1/pis/categories/"+e.id+"/singularities",function(a){console.log(a),c.parentLi=null,c.currentLi=d;var b=$("#treeRightContainer").addClass("active");b.find('[name="name"]').val(e.name),b.find('[name="itemDescription"]').val(e.description),b.find("#aEditSubCategory").show(),b.find(".trBtns").hide(),b.find('[name="singularityName"]').each(function(b,c){var d=$(c).parent().next("td").find("input");if(a.length<=b)c.value="",c.removeAttribute("data-id"),d.val("");else{var e=a[b];c.value=e.singularityName,c.setAttribute("data-id",e.id),d.val(e.description)}}),b.find(".form-control").attr("disabled",!0)});else{$("#treeRightContainer2").addClass("active")}}).on("click",".zTreeEdit input, .zTreeEdit i, .zTreeControl",function(a){a.stopPropagation()}).on("click",".icon-checkmark",function(a){a.stopPropagation();var b=$(this),d=b.parents(".zTreeItem:eq(0)"),e=d.data();if(!e||!e.id){e={};var f=d.parents(".zTreeItem:eq(0)").data();e.descendant=f.id}if(e.categoryName=d.find('[name="name"]').val(),e.description=d.find('[name="description"]').val(),!e.categoryName)return oc.dialog.tips("Name is required"),void d.find('[name="name"]').focus();b.removeClass("icon-checkmark").addClass("zLoadingIcon"),d.removeClass("zTreeItemDes");var g=function(a){return a===!1?void b.removeClass("zLoadingIcon").addClass("icon-checkmark"):(d.parents(".zTreeItem").addClass("hasMore"),e.level||(e.level=parseInt(f.level)+1),e.name=e.categoryName,d.data(e).find(">p").html(e.categoryName).removeClass("zTreeEdit zTreeAdd"),void(e.description&&d.addClass("zTreeItemDes").find("p").attr("title",e.description)))};e.id?c.updateNode(e,g):c.addNode(e,g)}).on("click",".icon-plus2",function(a){a.stopPropagation(),$(".treeRightContainer").removeClass("active");var b=$(this).parents(".zTreeItem:eq(0)").addClass("active"),d=b.data();if(d.level<3){var e=b.find(">ul");0===e.length&&(e=$("<ul></ul>").appendTo(b));var f=$('<li class="zTreeItem"></li>');f.append('<p class="zTreeEdit zTreeAdd"><input type="text" name="name" placeholder="name"><input type="text" name="description" placeholder="description"><i class="iconRight icon-checkmark" title="Save"></i></p>'),f.appendTo(e)}else if(c.currentLi=null,c.parentLi=b,3===d.level){var g=$("#treeRightContainer");g.addClass("active").find("input").removeAttr("disabled").val(""),g.find("#aEditSubCategory").hide(),g.find(".trBtns").show()}}),c.initRightForm()},c.initRightForm=function(){var a=$("#treeRightContainer form");a.submit(function(){var b={category:{categoryName:$('[name="name"]').val(),description:$('[name="itemDescription"]').val()},singularities:[]};a.find('[name="singularityName"]').each(function(){var a=$(this).parent().next("td").find("input"),d={singularityName:this.value,description:a.val(),singularityCode:b.singularities.length};c.parentLi||(d.id=this.getAttribute("data-id")),b.singularities.push(d)});var d=a.find('button[type="submit"]').html('<i class="zLoadingIcon"></i>').attr("disabled",!0);return c.parentLi?(b.category.descendant=c.parentLi.data().id,oc.ajax.post("/product/rest/v1/pis/categories/subcategory",b,function(a){d.html("Save").removeAttr("disabled"),oc.dialog.tips("Add success.");var e={id:a,fid:b.category.descendant,name:b.category.categoryName,description:b.category.description},f=c.parentLi.find("ul:eq(0)");0===f.length&&(f=$("<ul></ul>").appendTo(c.parentLi));var g=$('<li class="zTreeItem zTreeItemDes"><p title="'+e.description+'">'+e.name+"</p></li>").appendTo(f);g.data(e),c.parentLi.addClass("hasMore")},function(a){oc.dialog.tips("Update failed:"+a.responseText),d.html("Save").removeAttr("disabled")})):oc.ajax.put("/product/rest/v1/pis/categories/subcategory/"+c.currentLi.data().id,b,function(a){d.html("Save").removeAttr("disabled"),oc.dialog.tips("Update success."),$(".treeRightContainer").removeClass("active").find("input").val("");var e=c.currentLi.data();e.name=b.category.categoryName,e.description=b.category.description,c.currentLi.find(">p").html(e.name).attr("title",e.description),c.currentLi.data(e)},function(a){oc.dialog.tips("Update failed:"+a.responseText),d.html("Save").removeAttr("disabled")}),!1});var b=$("#treeRightContainer2 form");b.submit(function(){var a={};return a.subCategoryId=b.find("#categoryName").attr("data-id"),a.segmentId=b.find('select[name="sigment"]').val(),a.segmentText=b.find('select[name="sigment"]').find(":selected").text(),a.singularityId=b.find('select[name="singularity"]').val(),a.singularityText=b.find('select[name="singularity"]').find(":selected").attr("data-id"),a.countryCodeId=b.find('select[name="country"]').val(),a.countryCodeText=b.find('select[name="country"]').find(":selected").attr("data-code"),a.colorCodeId=b.find('select[name="color"]').val(),a.colorCodeText=b.find('select[name="color"]').find(":selected").attr("data-code"),oc.ajax.post("/product/rest/v1/pis/structure",a,function(a){console.log(a),oc.dialog.tips("Add success, MN is:<b>"+a.text+"</b>",3e3),$("#treeRightContainer2").removeClass("active"),window.open("/product/index.htm?mo=good&sku_add="+a.text)}),!1})},c.deleteNode=function(a,b){b()},c.updateNode=function(a,b){setTimeout(b,2e3)},c.addNode=function(a,b){console.log(a),setTimeout(b,2e3)},c.render()};b.exports=d},{}],17:[function(a,b,c){var d=function(a){this.config={container:"body",dataList:null,iptClass:"",width:"auto",height:"auto",showAll:!1,forbidPNode:!1},this.selectedItem=null,this.selectedList=null,this.ele=null,this.filterParams={},this.valueChangeHanlder=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c._render=function(){c.ele=$('<div class="zTreeSelect"><input type="text" style="width:'+this.config.width+'"></div>'),c.config.iptClass&&c.ele.find("input").addClass(c.config.iptClass),c._renderRecusive(c.config.dataList,c.ele,0),c.ele.appendTo($(c.config.container));var a=c.ele.offset().top,b=$(document).height(),d=b-a-150;150>d&&(d=150),c.ele.find(">ul").css("max-height",d),c._bindEvents(),c.config.showAll&&c.ele.find("input").val("All")},c._selectedP=function(a){if(0!==a.length){var b="";c.selectedItem=a.parent().data(),c.selectedList=[],a.parents(".zTreeSelectItem").each(function(){var a=$(this),d=a.data();c.selectedList.push(d),b=b?d.name+" - "+b:d.name}),c.selectedList.reverse(),c.ele.find("input").val(b).attr("data-id",c.selectedItem.id||""),c.ele.removeClass("active"),"All"===a.html()&&c.ele.find("input").val("All"),c.valueChangeHanlder&&c.valueChangeHanlder()}},c._setActive=function(){var a=c.ele.find(".zTreeSelectItem.active").data();a&&a.id?c.ele.find(".zTreeSelectItem:visible").each(function(b,d){var d=$(d);return d.data().id==a.id?(c.currentActive=b,!1):void 0}):c.currentActive=null},c._bindEvents=function(){c.ele.on("click",function(a){a.stopPropagation(),c.ele.hasClass("active")||(c.ele.addClass("active"),c._setActive(),c.filter(),c.selectedItem&&c.ele.find(".zTreeSelectItem").each(function(){var a=$(this),b=a.data();b==c.selectedItem&&a.find(">p").addClass("active")}))}).on("click","p",function(a){a.stopPropagation();var b=$(this);c.config.forbidPNode&&b.parent().find("ul>li").length>0||c._selectedP(b)}).on("input","input",function(a){c.ele.find(".zTreeSelectItem.active").removeClass("active"),c._clear(),c.filterParams.name=this.value,c.filter()}).on("mouseenter","li.zTreeSelectItem p",function(){c.ele.find(".zTreeSelectItem.active").removeClass("active"),$(this).parent().addClass("active"),c._setActive()}).find("input").on("keyup",function(a){a.preventDefault();var b=a.keyCode,d=c.ele.find(".zTreeSelectItem.active");if(13===b){var e=d.find(">p");return void c._selectedP(e)}if(40===b||38===b){if(40===b)0==d.length&&(c.currentActive=-1),c.currentActive++;else{if(!c.currentActive)return;c.currentActive--}var f=c.ele.find(".zTreeSelectItem:visible:eq("+c.currentActive+")");if(0!=f.length){c.ele.find(".zTreeSelectItem.active").removeClass("active"),f.addClass("active");var g=c.ele.find(">ul"),h=g.height(),i=f.offset().top,j=g.scrollTop();if(40===b){var k=i-h;k>0&&g.scrollTop(k+j)}else{var k=i-j;100>i&&g.scrollTop(j-32)}}}}),$(document).on("click",function(){c.ele.removeClass("active"),c.selectedItem||(c.filterParams.name=null,c.config.showAll?c.ele.find("input").val("All"):c.ele.find("input").val(""))})},c._clear=function(){c.selectedItem=null,c.selectedList=[]},c.setSelected=function(a){if(!a)return c.selectedItem=null,c.selectedList=[],
c.ele.find("input").val(""),void(c.config.showAll&&c.ele.find("input").val("All"));var b=null;c.selectedList=[];var d="";return c.ele.find("li").each(function(){var e=$(this),f=e.data();return f&&f.id&&f.id==a?(b=e,c.selectedItem=e.data(),c.selectedList.push(c.selectedItem),d=f.name,!1):void 0}),b?(b.parents(".zTreeSelectItem").each(function(){var a=$(this),b=a.data();c.selectedList.push(b),d=b.name+" - "+d}),c.selectedList.reverse(),c.ele.find("input").val(d),c.config.showAll&&""==d&&c.ele.find("input").val("All"),c.selectedList):void 0},c.filter=function(){c.ele.find("li.zTreeSelectItem").removeClass("hidden").show(),c.filterParams&&(c.filterParams&&c.filterParams.description&&c.ele.find('li.zTreeSelectItem[data-level="1"]').addClass("hidden").each(function(){var a=$(this),b=a.data();b.description&&-1===b.description.indexOf(c.filterParams.description)||a.removeClass("hidden")}),c.filterParams.name&&c.ele.find("li.zTreeSelectItem:visible").hide().each(function(){var a=$(this),b=a.data();b.name&&b.name.toUpperCase().indexOf(c.filterParams.name.toUpperCase())>-1&&(a.show(),a.find("li").show(),a.parents("li.zTreeSelectItem").show())}))},c._renderRecusive=function(a,b,d){if(a){var e=a.length,f=$("<ul></ul>");0===d&&(f.css("max-height",c.config.height),c.config.showAll&&$('<li class="zTreeSelectItem" data-level="0"><p style="padding-left:10px">All</p></li>').appendTo(f));for(var g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeSelectItem" data-level="'+d+'"><p style="padding-left:'+(20*d+10)+'px">'+h.name+"</p></li>");i.appendTo(f).data(h),h.items&&h.items.length>0&&c._renderRecusive(h.items,i,d+1)}e>0&&f.appendTo(b)}},c._render()};b.exports=d},{}],18:[function(require,module,exports){var UI={};UI.toggleBtn=function(a,b){void 0===a&&(a="ON",b="OFF");var c=this;$(".zToggleBtn, .zToggleBtnSm").each(function(){var d=$(this);c.toggleOneBtn(d,a,b)})},UI.toggleOneBtn=function(a,b,c){var d="zToggleBtn";a.removeClass("zToggleBtn"),a.hasClass("zToggleBtnSm")&&(a.removeClass("zToggleBtnSm"),d+=" zToggleBtnSm");var e=a[0].checked;e&&(d+=" active");var f=$('<span class="'+d+'"><i class="zToggleBtnON">'+b+'</i><i class="zToggleBtnOFF">'+c+"</i>"+a[0].outerHTML+"</span>");a.replaceWith(f),f.find("input").prop("checked",e),f.off("change","input").on("change","input",function(){this.checked?$(this).parents(".zToggleBtn:eq(0)").addClass("active"):$(this).parents(".zToggleBtn:eq(0)").removeClass("active")})},UI.autoComplete=function(ele,array,cb,prefix){ele=$(ele),"function"==typeof array&&(cb=array,array=null),ele.off("keyup").off("keydown").off("blur"),ele.on("keydown",function(a){var b=$(this),c=b.next("ul.zAutoComplete");return 13===a.keyCode&&c.find("li.active").length>0?(event.preventDefault(),!1):void 0}),ele.on("keyup",function(e){var ipt=$(this),ul=ipt.next("ul.zAutoComplete");if(40!==e.keyCode){if(38===e.keyCode){var focusLi=ul.find("li.active");if(0===focusLi.length)return;var prevLi=focusLi.prev("li");return void(prevLi.length>0&&(prevLi.addClass("active"),focusLi.removeClass("active")))}if(13!==e.keyCode){var source=array;if(!array){var sourceString=ipt.attr("data-source");source=sourceString?eval(sourceString):ipt.data("source")}if(source){$(".zAutoComplete").remove();var val=$.trim(this.value);if(prefix&&(val=val.replace(/.*;|.*,|.*\s/g,"")),val){var matchedArray=source.filter(function(a){return a.toUpperCase().indexOf(val.toUpperCase())>-1}),len=matchedArray.length;if(0!==len){len>8&&(len=8);for(var ul=$('<ul class="zAutoComplete"></ul>'),i=0;len>i;i++)ul.append('<li tabindex="0">'+matchedArray[i]+"</li>");var top=ipt.position().top+ipt.outerHeight(),left=ipt.position().left;ul.css({top:top,left:left}).on("click","li",function(){var a=$(this).html(),b=ipt.val();if(prefix){var c=b.match(/(.|,|\s)*(;|,|\s)/);b="",c&&c.length>0&&(b=c[0]),ipt.val(b+a)}else ipt.val(a);$(".zAutoComplete").remove(),cb&&cb(a,ipt)}).on("mouseenter","li",function(){ul.find(".active").removeClass("active"),$(this).addClass("active")}),ipt.after(ul)}}}}else{var focusLi=ul.find("li.active");if(focusLi.length>0){var slcVal=focusLi.html(),text=ipt.val();if(prefix){var mathedArray=text.match(/(.|,|\s)*(;|,|\s)/);text="",mathedArray&&mathedArray.length>0&&(text=mathedArray[0]),ipt.val(text+slcVal)}else ipt.val(slcVal);ul.remove(),cb&&cb(slcVal,ipt)}}}else{var focusLi=ul.find("li.active");if(0===focusLi.length)ul.find("li:eq(0)").addClass("active");else{var nextLi=focusLi.next("li");nextLi.length>0&&(nextLi.addClass("active"),focusLi.removeClass("active"))}}}).on("blur",function(){setTimeout(function(){$(".zAutoComplete").remove()},200)})},UI.cbx=function(){return $(".zCbx").off("change","input").on("change","input",function(){this.checked?$(this).parent().addClass("active"):$(this).parent().removeClass("active")}),{check:function(a){if(!a.hasClass("zCbx")){if(0===a.find("input:checkbox").length)return console.warn("zCkb does not contain a input:checkbox item");a.addClass("active").find("input:checkbox")[0].checked=!0}},unCheck:function(a){if(a.hasClass("zCbx")){if(0===a.find("input:checkbox").length)return console.warn("zCkb does not contain a input:checkbox item");a.removeClass("active").find("input:checkbox")[0].checked=!1}}}},UI.multiSelect=function(a){$("select.zMultiSelect").each(function(){var a=$(this),b=a.outerWidth(),c=a.outerHeight()+"px",d=a.attr("name");void 0===d&&(d="");var e=$('<div class="zMultiSelect"><div class="zMultiSelectText"></div><div class="zMultiSelectMain"><ul></ul></div></div>');e.css("width",b),e.find(".zMultiSelectText").css({height:c,"line-height":c}).html(a.attr("data-slc"));var f="";a.find("option").each(function(a,b){f+='<li><label class="zCbx"><input type="checkbox", name="'+d+'" value="'+b.value+'">'+b.innerHTML+"</label></li>"}),f+='<li><button class="btnPrimary btnXs" type="button">Confirm</button></li>',e.find("ul").html(f),a.replaceWith(e)}),UI.cbx();var b=function(){var b=$(".zMultiSelect");b.on("click",".zMultiSelectText",function(){var a=$(this).parents(".zMultiSelect:eq(0)");if(a.hasClass("active"))a.removeClass("active").find(".zMultiSelectMain").hide();else{a.addClass("active").find(".zMultiSelectMain").show();var b=this.innerHTML,c=b.split(";");a.find(".zCbx").removeClass("active").find("input:checkbox").attr("checked",!1);for(var d in c){var e=c[d],f=a.find('input:checkbox[value="'+e+'"]');f.length>0&&(f[0].checked=!0,f.parent().addClass("active"))}}}).on("click","button",function(b){var c=$(this).parents(".zMultiSelect:eq(0)"),d=$(this).parents(".zMultiSelectMain:eq(0)"),e="";d.find("input:checked").each(function(){e+=this.value+";"}),e&&(e=e.slice(0,-1)),c.removeClass("active").find(".zMultiSelectText").html(e),d.hide(),b.stopPropagation(),a&&a(c)}).click(function(a){a.stopPropagation()}),$("html").click(function(){b.removeClass("active").find(".zMultiSelectMain").hide()})};b()},UI.popOver=function(a,b,c,d){if(a=$(a),a.next(".zPopOver").length>0)return void a.next(".zPopOver").remove();var e=$('<div class="zPopOver zPopOver'+d+'"></div>');e.append('<div class="zPopOverTitle">'+b+'<i class="icon-close"></i></div>'),e.append('<div class="zPopOverContent">'+c+"</div>"),a=$(a);var f=a.position();a.after(e);var g=f.left+a.outerWidth()+20,h=f.top+a.outerHeight()/2-e.outerHeight()/2-5;"left"===d?g=f.left-e.outerWidth()-20:"top"===d?(g=f.left-e.outerWidth()/2+a.outerWidth()/2,h=f.top-e.outerHeight()-20):"bottom"===d&&(g=f.left-e.outerWidth()/2+a.outerWidth()/2,h=f.top+a.outerHeight()+20),e.css({left:g,top:h}),e.on("click",".zPopOverTitle i.icon-close",function(){e.remove()})},UI.popOverRemove=function(a){var a=$(a);a.hasClass(".zPopOver")?a.remove():a.next(".zPopOver").remove()},module.exports=UI},{}],19:[function(a,b,c){var d=function(a){var b=this;this.config={container:"body",maxSize:10,uploadAction:"/upload",postParams:{},oneFileLimit:10485760,callback:null,uploadOneCallback:null},this.deleteFile=null,this.STATUS={waiting:0,process:1,success:2,failed:3},this.files=[],this.ele=null,this.msg="",this.queueSize=0,this.uploadedSize=0,this.slice=Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice;for(var c in a)this.config.hasOwnProperty(c)&&(this.config[c]=a[c]);b._renderFoot=function(){var a=$('<div class="zUploaderFoot"></div>');return a.append('<p class="zUploaderStatic">选中0个文件，共0K</p>'),a.append('<span class="zUploaderControl"><span class="zUploaderFileBtn"><input type="file" multiple="multiple" /><span class="zUploaderBtnText">继续添加</span></span><button class="zUploaderBtn" type="button">开始上传</button></span>'),a},b._renderNoFile=function(){var a=$('<div class="zUploaderNoFile"></div>');return a.append('<div class="icon"><i class="icon-images"></i></div>'),a.append('<span class="zUploaderFileBtn "><input type="file" multiple="multiple" /><span class="zUploaderBtnText">点击选择文件</span></div>'),a.append("<p>或将文件拖到这里，单次最多可上传文件"+b.config.maxSize+"个</p>"),a},b._render=function(){b.ele=$('<div class="zUploader"></div>');var a=$('<div class="zUploaderList"></div>');a.append(b._renderNoFile());var c=b._renderFoot().hide();b.ele.append(a),b.ele.append(c),b.ele.appendTo(b.config.container)},b.reloadList=function(){b.ele.find(".zUploaderItem").remove();var a=b.files.length;if(0===a)return b.ele.find(".zUploaderNoFile").show(),void b.ele.find(".zUploaderFoot").hide();b.ele.find(".zUploaderNoFile").hide(),b.ele.find(".zUploaderFoot").show();for(var c=b.ele.find(".zUploaderList"),d=0,e=0,f=0;a>f;f++){var g=b.files[f];g.status==b.STATUS.waiting&&(d+=g.size,e++);var h=b._renderOneFile(g);g.target=h,c.append(h)}b.ele.find(".zUploaderStatic").html("选中"+e+"个文件，共"+(d/1e3).toFixed(2)+"K")},b._pushFiles=function(a){for(var c=0;c<a.length;c++){var d=a[c];if($.inArray(d,b.files)>-1)oc.dialog.tips(d.name+"文件已经存在");else if(d.size>b.config.oneFileLimit)oc.dialog.tips("文件"+d.name+"超出了最大限制");else{if(b.files.length===b.config.maxSize)return alert("超出了最大文件数量"),!1;a[c].status=b.STATUS.waiting,b.files.push(a[c])}}b.reloadList()},b._deleteFile=function(a){if(b.files[a].status===b.STATUS.process)return alert("改文件当前不允许删除");var c=b.files[a];c.status===b.STATUS.success?b.deleteFile&&b.deleteFile(c,function(){b.files.splice(a,1),b.reloadList()}):(b.files.splice(a,1),b.reloadList())},b._bindEvent=function(){b.ele.on("change",'.zUploaderFileBtn input[type="file"]',function(){b._pushFiles(this.files)}).on("click",".zUploaderBtn",b._upload).on("click",".zUploaderItemHd i",function(){var a=$(this).parents(".zUploaderItem"),c=a.index();b._deleteFile(c-1)}).on("click",".zUploaderReset",function(a){b.files.map(function(c){c.status=b.STATUS.waiting,c.msg="",c.target.find(".zUploaderMsg").removeClass("error").html(""),a.preventDefault()})}),b.ele[0].addEventListener("drop",function(a){a.preventDefault(),b._pushFiles(a.dataTransfer.files)}),$(document).on({dragleave:function(a){a.preventDefault()},drop:function(a){a.preventDefault()},dragenter:function(a){a.preventDefault()},dragover:function(a){a.preventDefault()}})},b._renderOneFile=function(a){var c=$('<div class="zUploaderItem"></div>');c.append('<div class="icon"><i class="icon-images"></i></div>'),c.append('<p class="zUploaderMsg"></p>'),c.append('<div class="zUploaderItemHd"><i class="icon-cross"></i></div>');var d=a.name;if(d.length>25&&(d=d.slice(0,20)+" ..."),c.append('<p class="zUploaderName">'+d+"</p>"),a.status===b.STATUS.success?(c.find(".zUploaderMsg").addClass("ok").html("upload success"),b.deleteFile||c.find(".zUploaderItemHd").remove()):a.status===b.STATUS.failed&&c.find(".zUploaderMsg").addClass("error").html("upload failed").attr("title",a.msg),/image\/\w+/.test(a.type)){var e=new FileReader;e.onload=function(){var a=e.result;c.find(".icon i").replaceWith('<img src="'+a+'" />')},e.readAsDataURL(a)}return c},b.setStatus=function(a,c,d){a.status=c,c===b.STATUS.success?(a.target.find(".zUploaderMsg").addClass("ok").html("upload success"),a.target.find(".zUploaderItemHd").remove(),a.status=b.STATUS.success):c===b.STATUS.failed&&(a.target.find(".zUploaderMsg").addClass("error").html("upload failed"),a.status="failed")},b._uploadOneFile=function(a,c){return b.setStatus(a,b.STATUS.process),window.FormData&&window.XMLHttpRequest?void b._sendFileByFormData(a,c):void 0},b._sendFileByFormData=function(a,c){var d=new XMLHttpRequest;d.open("POST",b.config.uploadAction,!0);var e=new FormData;e.append("file",a),d.upload.onload=function(a){},d.upload.onprogress=function(a){b._process(a.loaded,!0)},d.upload.onerror=function(d){b._process(a.size),b.setStatus(a,b.STATUS.failed,"文件传输中断:"+res.statusText),c()},d.onreadystatechange=function(){4==d.readyState&&200==d.status&&(b._process(a.size),a.response=JSON.parse(d.response),a.response.flag===!0?b.setStatus(a,b.STATUS.success):b.setStatus(a,b.STATUS.failed),c())},d.send(e)},b._process=function(a,c){var d=b.ele.find(".zUploaderStatic"),e=d.find(".zUploaderProcess");0===e.length&&(d.html(""),e=$('<span class="zUploaderProcess"><span class="zUploaderProcessInner"></span></span>').appendTo(d),eleProcesText=$('<span class="zUploaderProcessText"></span>').appendTo(d));var f=b.uploadedSize+a;0!==a&&e.attr("data-count",f).find(".zUploaderProcessInner").css("width",100*f/b.queueSize+"%"),d.find(".zUploaderProcessText").html("( "+(f/1e3).toFixed(2)+" KB / "+(b.queueSize/1e3).toFixed(2)+" KB )"),c!==!0&&(b.uploadedSize+=a)},b._upload=function(){var a=b.files.filter(function(a){return a.status===b.STATUS.process});if(a.length>0)return alert("有文件正在上传，请稍后...");b.queueSize=0,b.uploadedSize=0;var c=b.files.filter(function(a){return a.status===b.STATUS.waiting?(b.queueSize+=a.size,!0):!1});b._process(0);var d=0,e=function(){return d===c.length?(b._setFootStatics(),void(b.config.callback&&b.config.callback(b.files))):void b._uploadOneFile(c[d],function(){b.config.uploadOneCallback&&b.config.uploadOneCallback(c[d]),e(d++)})};e()},b._setFootStatics=function(){var a=b.files.filter(function(a){return a.status==b.STATUS.success}),c=a.length,d=b.files.length-c,e="已成功上传"+c+"个文件";d>0&&(e+="，"+d+'个文件上传失败，<a class="zUploaderReset" href="#">重置失败文件？</a>'),b.ele.find(".zUploaderStatic").html(e)},b._render(),b._bindEvent()};b.exports=d},{}]},{},[9]);