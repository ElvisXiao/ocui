/*! Tinyp2p 2015-04-15 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c={};c._send=function(a,b,c,d,e){var f={url:a,type:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}};b&&(f.method=b),c&&(f.data=JSON.stringify(c)),$.ajax(f,d,e)},c.get=function(a,b,c){this._send(a,null,null,b,c)},c.post=function(a,b,c,d){this._send(a,null,b,c,d)},c.put=function(a,b,c,d){this._send(a,null,b,c,d)},c["delete"]=function(a,b,c){this._send(a,null,null,b,c)},b.exports=c},{}],2:[function(a,b){!function(a){"use strict";function c(a,b){var c=b.toString(),d=c.substring(1,c.lastIndexOf("/")),e=c.substring(c.lastIndexOf("/")+1);return-1===e.indexOf("g")&&(b=new RegExp(d,e+"g")),a.split(b)}function d(a){return""===a.replace(/^[\s]*|[\s]*$/g,"")}function e(a){var b;for(b=0;b<a.length;b++)d(a[b])&&a.splice(b--,1)}function f(a,b){var c,d,e,f;for(c=0;c<a.length;c++)if(e=a[c].replace(/^[\s]*|[\s]*$/g,""),f="",('"'===e.charAt(0)||"'"===e.charAt(0))&&(f=e.charAt(0)),""!==f&&e.slice(-1)!==f){for(d=c+1,d<a.length&&(e=a[d].replace(/^[\s]*|[\s]*$/g,""));d<a.length&&e.slice(-1)!==f;)a[c]+=b+a.splice(d,1)[0],e=a[d].replace(/[\s]*$/g,"");d<a.length&&(a[c]+=b+a.splice(d,1)[0])}}function g(a){var b;for(b=0;b<a.length;b++)a[b]=a[b].replace(/^[\s]*|[\s]*$/g,"")}function h(a){var b;for(b=0;b<a.length;b++)'"'===a[b].charAt(0)?a[b]=a[b].replace(/^"|"$/g,""):"'"===a[b].charAt(0)&&(a[b]=a[b].replace(/^'|'$/g,""))}function i(a,b){var c=a.split(b);return f(c,b),g(c),h(c),c}function j(a,b){var c,d=[];for(c=0;c<a.length;c++)d[c]=i(a[c],b);return d}function k(a){var b,c,d,e,f,g=[],h=a[0];for(b=1;b<a.length;b++)if(d=a[b],d.length>0){if(d.length>h.length)throw new SyntaxError("not enough header fields");for(e={},c=0;c<h.length;c++)f=h[c],e[f]=c<d.length?d[c]:"";g.push(e)}return g}var l={};l.parse=function(a,b,d,f){var g,h,i,l={lineEnding:/[\r\n]/,delimiter:",",ignoreEmptyLines:!0};if(""===a)throw new SyntaxError("empty input");if("undefined"!=typeof b&&(l.lineEnding=b instanceof RegExp?b:new RegExp("["+String(b)+"]","g")),"undefined"!=typeof d&&(l.delimiter=String(d)),"undefined"!=typeof f&&(l.ignoreEmptyLines=!!f),g=c(a,l.lineEnding),l.ignoreEmptyLines&&e(g),g.length<2)throw new SyntaxError("missing header");return h=j(g,l.delimiter),i=k(h)},"object"==typeof b&&b&&"object"==typeof b.exports?b.exports=l:"function"==typeof define&&define.amd?define([],function(){return l}):a.CSV=l}("undefined"!=typeof window?window:{})},{}],3:[function(a,b){var c={};c.removeMadal=function(){this.removeAllTips(),this.close()},c.removeAllTips=function(){$(".zLoading, .tips").remove()},c.tips=function(a,b,c){void 0===b&&(b=1500),"function"==typeof b&&(c=b,b=1e3);var d=$('<div class="tips">'+a+"</div>");d.appendTo("body");var e=d.width();d.css("margin-left",-e/2+"px"),setTimeout(function(){d.remove(),c&&c()},b)},c.loading=function(a){this.removeMadal();var b=$('<div class="zLoading"></div><div class="tips">'+a+"</div>");b.appendTo("body");var c=$(".tips").width();return b.css("margin-left",-c/2+"px"),b},c.confirm=function(a,b,d,e){var f=$('<div class="zLoading"></div><div class="tips confirm" style="min-width: 500px;">'+a+'<div style="border-top: 1px dashed #ddd;" class="tc mt20 pt10"><button class="btn btn-info btn-sm btnOK mr20 w80">OK</button><button class="btn btn-default btn-sm btnCancel w80" style="margin-right: 0">Cancel</button></div></div>');f.appendTo("body").on("click",".btnOK, .btnCancel",function(){var a=f.find("input, textarea"),g="";if(a.length>0&&(g=a.val()),$(this).hasClass("btnOK")){if(e===!0&&a.length>0&&!g)return c.tips("message is required."),void a.focus();b&&b(g)}else d&&d(g);f.remove()}).on("click","input, textarea",function(){f.removeClass("has-error")});var g=$(".tips").width();return f.css("margin-left",-g/2+"px"),f},c.open=function(a,b,c){this.removeMadal(),b||(b=a,a="");var d=$('<div class="zDialogCover"><div class="zDialog"><p class="zDialogTitle"><span class="close">×</span>'+a+"</p></div></div>").appendTo(document.body),e=d.find(".zDialog");e.append(b);var f=e.outerWidth(),g=e.outerHeight();e.css({"margin-left":-f/2+"px",left:"50%"});var h=$(document).outerHeight();e.on("click",".close",function(){e.animate({top:0,opacity:0},500,function(){d.remove()})});var i="20%";g>h&&(i="5%"),e.animate({top:i,opacity:1},500,function(){c&&c()})},c.close=function(){var a=$(".zDialogCover");if(a.length){var b=a.find(".zDialog");b.animate({top:0,opacity:0},500,function(){a.remove()})}},b.exports=c},{}],4:[function(a,b){var c=function(b){this.csv=a("./asset/csv"),this.ele=null,this._dataList=[],this.canEdit=!0,this.maxHeight=800,this.config={container:"body",canEdit:!0,maxHeight:800,heads:[]};for(var c in b)this.config.hasOwnProperty(c)&&(this.config[c]=b[c]);var d=this;d._render=function(){d.ele=$('<div class="zUploader"></div>');var a=$('<div class="zUploaderList"></div>');a.append(d._renderNoFile()),d.ele.append(a),d.ele.appendTo(d.config.container)},d._renderNoFile=function(){var a=$('<div class="zUploaderNoFile" style="padding:15px 0 0 0;"></div>');return a.append('<span class="zUploaderFileBtn "><input type="file" accept=".csv" /><span class="zUploaderBtnText">点击选择文件</span></div>'),a.append("<p>或将文件拖到这里, 暂仅支持CSV格式</p>"),a},d._bindEvent=function(){d.ele.on("change",'.zUploaderFileBtn input[type="file"]',function(){d._readFilesToTable(this.files[0])}),d.ele.find(".zUploaderNoFile")[0].addEventListener("drop",function(a){$(this).css("border","3px dashed #e6e6e6"),a.preventDefault(),d._readFilesToTable(a.dataTransfer.files[0])}),d.ele.on("dragenter",".zUploaderNoFile",function(a){a.preventDefault(),$(this).css("border","3px dashed #aaa")}).on("dragleave",".zUploaderNoFile",function(a){a.preventDefault(),$(this).css("border","3px dashed #e6e6e6")}),$(document).on({dragleave:function(a){a.preventDefault()},drop:function(a){a.preventDefault()},dragenter:function(a){a.preventDefault()},dragover:function(a){a.preventDefault()}}),d.ele.on("blur",".zFileTable tbody td input",function(){var a=this.value,b=$(this),c=b.parent(),e=c.attr("data-index"),f=e.split(","),g=f[0],h=f[1];d._dataList[g][h]=a})},d.readCsv=function(a,b){var c=new FileReader;c.onload=function(){$('input[type="file"]').replaceWith($('<input type="file" accept=".csv">'));var a=c.result;d._formatFileContent(a),b()},c.readAsText(a)},d._formatFileContent=function(a){var b=d.csv.parse(a),c=b[0],e=[];for(var f in c)e.push(f);d._dataList=[],d._dataList.push(e);for(var g=0;g<b.length;g++){var h=b[g],i=[];for(var f in h)i.push(h[f]);d._dataList.push(i)}},d._readFilesToTable=function(a){d.readCsv(a,function(){$(".zFileTableContainer").remove();var a=$('<div class="zFileTableContainer"><table class="zFileTable"></table></div>');d.config.maxHeight&&a.css("max-height",d.config.maxHeight+"px");var b=a.find(".zFileTable");if(d._dataList&&d._dataList.length>0){for(var c=d._dataList[0],e=c.length,f=$("<thead></thead>"),g=$("<tbody></tbody>"),h=$("<tr><th></th></tr>").appendTo(f),i=0;e>i;i++)h.append("<th>"+c[i]+"</th>");for(var i=1;i<d._dataList.length;i++){for(var j=d._dataList[i],k=$("<tr><td>"+i+"</td></tr>"),l=0;e>l;l++)k.append('<td data-val="true", data-index="'+i+","+l+'">'+$.trim(j[l])+"</td>");g.append(k)}b.append(f),b.append(g)}var m=d.ele.find(".zUploaderList");m.find(".zFileTable").remove(),a.appendTo(m),d.setEditTable(b)})},d.setEditTable=function(a){d.config.canEdit===!0&&a.find("tbody td[data-val]").each(function(){var a=$(this),b=a.html();a.html('<span class="tdSpan">'+b+'</span><input class="tdIpt" type="text" value="'+b+'" />')})},d.getDataList=function(){var a=[];if(!d._dataList||0===d._dataList.length)return null;var b=d._dataList[0];d.config.heads&&d.config.heads.length>0&&(d.config.heads.length>b.length&&(d.config.heads=d.config.heads.slice(0,b.length)),b=b.slice(d.config.heads.length),b=d.config.heads.concat(b));for(var c=b.length,e=1;e<d._dataList.length;e++){for(var f=d._dataList[e],g={},h=0;c>h;h++)g[b[h]]=$.trim(f[h]);a.push(g)}return a},d.mark=function(a){for(var b=a.length,c=0;b>c;c++){var e=a[c],f=e.row+","+e.col,g=d.ele.find('tbody td[data-index="'+f+'"]');g.addClass("zFileTableMark").attr("title",e.msg)}},d.clearMark=function(){d.ele.find("tbody .zFileTableMark").removeAttr("title").removeClass("zFileTableMark")},d._render(),d._bindEvent()};b.exports=c},{"./asset/csv":2}],5:[function(a){!function(){window.oc={},oc.ui=a("./ui"),oc.dialog=a("./dialog"),oc.localSorage=a("./localStorage"),oc.FileView=a("./fileView"),oc.Uploader=a("./uploader"),oc.TreeSelect=a("./treeSelect"),oc.TreeDialogSelect=a("./treeDialogSelect"),oc.Tree=a("./tree"),oc.Sidebar=a("./sidebar"),oc.TreeOrganization=a("./treeOrganization"),oc.ajax=a("./ajax");var b=$("script[data-occss]").attr("data-occss");b?($("<link>").attr({rel:"stylesheet",type:"text/css",href:b}).appendTo("head"),b.replace("oc.css","icons/style.css"),$("<link>").attr({rel:"stylesheet",type:"text/css",href:b}).appendTo("head")):location.href.indexOf("/product")>0?($("<link>").attr({rel:"stylesheet",type:"text/css",href:"/product/js/oc/oc.css"}).appendTo("head"),$("<link>").attr({rel:"stylesheet",type:"text/css",href:"/product/js/oc/icons/style.css"}).appendTo("head")):($("<link>").attr({rel:"stylesheet",type:"text/css",href:"//ui.tinyp2p.com/dest/oc.css"}).appendTo("head"),$("<link>").attr({rel:"stylesheet",type:"text/css",href:"//ui.tinyp2p.com/icons/style.css"}).appendTo("head"))}()},{"./ajax":1,"./dialog":3,"./fileView":4,"./localStorage":6,"./sidebar":7,"./tree":8,"./treeDialogSelect":9,"./treeOrganization":10,"./treeSelect":11,"./ui":12,"./uploader":13}],6:[function(a,b){var c={storage:window.localStorage};c.set=function(a,b){if("string"!=typeof a)return void console.error("key mast to be a string");var c=JSON.stringify(b);this.storage.key=c},c.get=function(a){if("string"!=typeof a)return console.error("key mast to be a string"),null;var b=this.storage[a]||null,c=JSON.parse(b);return c},c.remove=function(a){this.storage.removeItem(a)},c.clear=function(){this.storage.clear()},b.exports=c},{}],7:[function(a,b){var c=function(a,b){this.container=b,this.dataList=a;var c=this;c._render=function(){var a=$('<aside class="zSideBar"><ul class="zSideBarUl"></ul></aside>'),d=a.find("ul");c.dataList.map(function(a){var b=$("<li><a>"+a.name+"</a></li>");if(b.appendTo(d),a.hash&&b.find(">a").attr("href",a.hash),a.children){b.addClass("hasMore").append("<ul></ul>");var c=b.find("ul");a.children.map(function(a){var b=$("<li><a>"+a.name+"</a></li>");b.appendTo(c),a.hash&&b.find(">a").attr("href",a.hash)})}}),a.appendTo($(b))},c._render()};b.exports=c},{}],8:[function(a,b){var c=function(a){this.config={container:"body",data:null,showLevel:1},this.ele=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c.render=function(){c.ele=$('<ul class="zTree"></ul>');var a=$('<li class="zTreeItem"><p>'+c.config.data.name+"</p></li>").data(c.config.data);a.appendTo(c.ele),c._renderRecusive(c.config.data.items,a,0),$(this.config.container).find(".zTree").remove(),$(this.config.container).append(c.ele),c._bindEvents()},c.filter=function(a){c.removeFilterTag(),a&&(a=a.toUpperCase(),c.ele.find(".zTreeItem:gt(0)").removeClass("active").each(function(){var b=$(this),c=b.find(">p").html().toUpperCase();0===c.indexOf(a)&&(b.parents(".zTreeItem").addClass("active"),b.addClass("treeTag"))}))},c.removeFilterTag=function(){c.ele.find(".treeTag").removeClass("treeTag")},c._renderRecusive=function(a,b,d){if(a){var e=a.length;e>0&&b.addClass("hasMore"),d<this.config.showLevel&&b.addClass("active");for(var f=$("<ul></ul>"),g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeItem"><p>'+h.name+"</p></li>");h.description&&i.addClass("zTreeItemDes").find(">p").attr("title",h.description),i.appendTo(f).data(h),h.items&&h.items.length>0&&c._renderRecusive(h.items,i,d+1)}e>0&&f.appendTo(b)}},c._bindEvents=function(){c.ele.on("click",".zTreeItem p",function(){$(this).parent().toggleClass("active")}).on("mouseenter",".zTreeItem p",function(){$('<span class="zTreeControl"><i class="icon-plus2"></i><i class="icon-cog"></i><i class="icon-minus2 none"></i></span>').hide().appendTo(this).fadeIn(1e3)}).on("mouseleave",".zTreeItem p",function(){$(this).find(".zTreeControl").remove()}).on("click",".icon-minus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)"),d=b.parent(),e=b.data();if(!e||!e.id)return void b.fadeOut(500,function(){b.remove(),0===d.find(".zTreeItem").length&&d.remove()});var f=b.data().id;c.deleteNode(f,function(){b.fadeOut(500,function(){b.remove(),0===d.find(".zTreeItem").length&&d.remove()})})}).on("click",".icon-cog",function(a){a.stopPropagation();var b=$(this).parent().parent();b.addClass("zTreeEdit"),b.html('<input type="text" name="name" placeholder="name"><input type="text" name="description" placeholder="category, separate by dot or space"><i class="iconRight icon-checkmark"></i>');var c=b.parent().data();b.find('[name="name"]').val(c.name),b.find('[name="description"]').val(c.description)}).on("click",".zTreeEdit input, .zTreeEdit i, .zTreeControl",function(a){a.stopPropagation()}).on("click",".icon-checkmark",function(a){a.stopPropagation();var b=$(this);b.removeClass("icon-checkmark").addClass("zLoadingIcon");var d=b.parents(".zTreeItem:eq(0)").removeClass("zTreeItemDes"),e=d.data();if(!e||!e.id){e={};var f=d.parents(".zTreeItem:eq(0)").data();e.fid=f.id,e.level=parseInt(f.level)+1}e.name=d.find('[name="name"]').val(),e.description=d.find('[name="description"]').val();var g=function(a){return a===!1?void b.removeClass("zLoadingIcon").addClass("icon-checkmark"):(d.parents(".zTreeItem").addClass("hasMore"),d.data(e).find(">p").html(e.name).removeClass("zTreeEdit"),void(e.description&&d.addClass("zTreeItemDes").find("p").attr("title",e.description)))};e.id?c.updateNode(e,g):c.addNode(e,g)}).on("click",".icon-plus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)").addClass("active"),c=b.find(">ul");0===c.length&&(c=$("<ul></ul>").appendTo(b));var d=$('<li class="zTreeItem"></li>');d.append('<p class="zTreeEdit zTreeAdd"><input type="text" name="name" placeholder="name"><input type="text" name="description" placeholder="category, separate by dot or space"><i class="iconRight icon-checkmark"></i></p>'),d.appendTo(c)})},c.deleteNode=function(a,b){b()},c.updateNode=function(a,b){setTimeout(b,2e3)},c.addNode=function(a,b){setTimeout(b,2e3)},c.render()};b.exports=c},{}],9:[function(a,b){var c=function(a,b){this.ele=$(a),this.valueChangeHanlder=null,this.dialogPanel=$('<div class="treeDialogSelect"></div>'),this.dataList=b,this.productLine=null,this.keyword="",this.canSelectedFolder=!1;var c=this;c._render=function(){c.dialogPanel.append('<div class="borderBottom pb10 pl10"><span style="padding-right:58px;">Search:</span><input id="txtKeyword" type="text" class="ipt w200"><span class="ml20 f12 spanInfo" style="color:#888"><i class="icon-info mr5" style="color:#eea236;"></i>eg:Search to the items and it\'s children. </span></div>'),c.canSelectedFolder&&c.dialogPanel.find(".spanInfo").append(" Double click to select the folder.");for(var a=$('<ul class="ulResposible ulData"><li class="liTitle">Resposibles:</li></ul>'),b=[],d=0;d<c.dataList.length;d++){var e=c.dataList[d],f=$('<li class="liFolder">'+e.name+"</li>").data(e);f.appendTo(a),e.items&&e.items.map(function(a){var c=a.description;if(!c)return!0;for(var d=c.split(/[\s|,]/g),e=0;e<d.length;e++)-1===$.inArray(d[e],b)&&b.push(d[e])})}b.sort();var g=$('<ul class="ulProductLine"><li class="liTitle">Product Lines:</li></ul>');b.map(function(a){g.append("<li>"+a+"</li>")}),c.productLine&&g.find("li:contains("+c.productLine+")").addClass("active"),g.appendTo(c.dialogPanel),a.appendTo(c.dialogPanel),c._bindEvents()},c._setSelected=function(){var a=c.ele.data("selectedList");a&&a.length>0&&a.map(function(a){var b=$(".zDialog .ulData:last"),d=b.find("li:eq("+a.eleIndex+")").addClass("active");c._renderChild(b,d)})},c._renderChild=function(a,b){var d=b.data();if(d.items&&d.items.length){var e=$('<ul class="ulData"><li class="liTitle">Children:</li></ul>');d.items.map(function(b){var d=$('<li title="'+b.name+'">'+b.name+"</li>").data(b);d.addClass(b.items&&0!==b.items.length?"liFolder":"liData"),e.append(d),c.productLine&&a.hasClass("ulResposible")&&b.description&&-1===b.description.indexOf(c.productLine)&&d.hide()}),a.after(e),d.items&&d.items.length>0&&c._needFilter(b)&&c.filter(e.find("li"))}},c._needFilter=function(a){var b=a.parent().prevAll(".ulData").find("li.active");b=a.add(b);var d=!1;return b.each(function(){var a=$(this),b=a.data(),e=b.name.toUpperCase();return b.description&&c.productLine&&-1===b.description.indexOf(c.productLine)?!0:c.keyword&&0!==e.indexOf(c.keyword)?!0:(d=!0,!1)}),!d},c._bindEvents=function(){c.ele.off("click").on("click",function(){c.dialogPanel.html(""),c._render(),c.keyword=null,oc.dialog.open("",c.dialogPanel,function(){$(".zDialog").css("top","5%"),c._setSelected()}),c.dialogClickHanlder()})},c.filter=function(a){a||(a=$("ul.ulData li")),a.each(function(){var a=$(this).show();if(a.hasClass("liTitle"))return!0;var b=a.data();if(b.description&&c.productLine&&-1===b.description.indexOf(c.productLine))return a.hide(),!0;var d=b.name.toUpperCase();c.keyword&&0!==d.indexOf(c.keyword)&&(c.filterChildren(b.items)||a.hide())})},c.filterChildren=function(a){var b=!1,d=function(a){if(!a||0===a.length)return b;if(b===!0)return b;for(var e=0;e<a.length;e++){if(b===!0)return!0;var f=a[e],g=!0,h=f.name.toUpperCase();if(f.description&&c.productLine&&-1===f.description.indexOf(c.productLine)?g=!1:c.keyword&&0!==h.indexOf(c.keyword)&&(g=!1),g===!0)return b=!0,!0;d(f.items)}};return d(a),b},c.selectedHanlder=function(){var a=$(this);if(!a.hasClass("liFolder")||c.canSelectedFolder){var b=a.data();b.eleIndex=a.index(),c.ele.data("selectedItem",b);var d=a.parent(),e=[];d.prevAll("ul.ulData").each(function(){var a=$(this).find("li.active");a.data().eleIndex=a.index(),e.push(a.data())}),e.reverse(),e.push(b),c.ele.data("selectedList",e),c.ele.val(this.innerHTML),oc.dialog.close()}},c.dialogClickHanlder=function(){$(".zDialog").on("click","li.liFolder",function(){var a=$(this),b=a.parent();b.find(".active").removeClass("active"),a.addClass("active"),b.nextAll(".ulData").remove(),c._renderChild(b,a)}).on("dblclick","li.liFolder",c.selectedHanlder).on("click","li.liData",c.selectedHanlder).on("click",".ulProductLine li:gt(0)",function(){var a=$(this);return a.hasClass("active")?(a.removeClass("active"),c.productLine=null,void $(".zDialog .ulData:eq(1) li").show()):(a.parent().find(".active").removeClass("active"),a.addClass("active"),c.productLine=a.html(),void c.filter())}).on("input","#txtKeyword",function(){c.keyword=$.trim(this.value).toUpperCase(),c.filter()})},c.setSelectedByIds=function(a){var b=[],d=null;a&&a.length||c.ele.html("");for(var e=$.extend([],c.dataList),f=0;f<a.length;f++){var g=a[f];if(!g)break;for(var h=null,i=0;i<e.length;i++){var j=e[i];if(j.id==g){h=j;break}}if(!h)break;h.eleIndex=i+1,e=$.extend([],h.items),b.push(h),d=h}var k="";d&&(k=d.name),c.ele.data("selectedList",b),c.ele.data("selectedItem",d),c.ele.val(k)},c._render()};b.exports=c},{}],10:[function(a,b){var c=function(a){this.config={container:"body",data:null,showLevel:1,family:null,allUser:null,isShowAdmin:!1},this.ele=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c.render=function(){c.ele=$('<ul class="zTree zTreeOrganization"></ul>');var a=$('<li class="zTreeItem zTreeItemFolder"><p>海翼电商</p></li>').data(c.config.data);a.appendTo(c.ele),c._renderRecusive(c.config.data.children,a,0),c.ele.find(">li>ul>li").removeAttr("draggable"),c.ele.appendTo($(this.config.container)),c._bindEvents()},c.filter=function(a){c.removeFilterTag(),a&&(a=a.toUpperCase(),c.ele.find(".zTreeItem:gt(0)").removeClass("active").each(function(){var b=$(this),c=b.find(">p").html().toUpperCase();0===c.indexOf(a)&&(b.parents(".zTreeItem").addClass("active"),b.addClass("treeTag"))}))},c.removeFilterTag=function(){c.ele.find(".treeTag").removeClass("treeTag")},c._renderRecusive=function(a,b,d){if(a){var e=a.length;e>0&&b.addClass("hasMore"),d<this.config.showLevel&&b.addClass("active");for(var f=$("<ul></ul>"),g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeItem" draggable="true"><p>'+h.name+"</p></li>");null!==h.level&&i.addClass("zTreeItemFolder"),i.appendTo(f).data(h),h.children&&h.children.length>0&&c._renderRecusive(h.children,i,d+1)}e>0&&f.appendTo(b)}},c._setToolTip=function(a){var b=a.data(),c=b.adminUserName||"";if(c){var d=b.admin2UserName?", "+b.admin2UserName:"";c+=d}else c=b.admin2UserName||"";if(c){var e=a.find("p");a.find("p").attr("data-toggle","tooltip").attr("data-placement","top").attr("title","admin: "+c),e.tooltip&&e.tooltip("destroy")&&e.tooltip()}},c.toggleAdmin=function(){c.config.isShowAdmin?(c.config.isShowAdmin=!1,c.ele.find(".zTreeItemFolder>p>.spanAdmin").remove()):(c.config.isShowAdmin=!0,c.ele.find(".zTreeItemFolder>p").each(function(){var a=$(this),b=a.parent(),d=c.getAdminString(b);d&&a.append('<span class="spanAdmin"> ('+d+")")}))},c.getAdminString=function(a){var b=a.data(),c=b.adminUserName||"";if(c){var d=b.admin2UserName?", "+b.admin2UserName:"";c+=d}else c=b.admin2UserName||"";return c},c._setAdmin=function(a){if(c.config.isShowAdmin&&a.hasClass("zTreeItemFolder")){var b=a.data(),d=b.adminUserName||"";if(d){var e=b.admin2UserName?", "+b.admin2UserName:"";d+=e}else d=b.admin2UserName||"";if(d){var f=a.find(">p");f.find(".spanAdmin").remove(),f.append('<span class="spanAdmin"> ('+d+")")}}},c._bindEvents=function(){c.ele.on("click",".zTreeItem p",function(){$(this).parent().toggleClass("active")}).on("mouseenter",".zTreeItem p",function(){$('<span class="zTreeControl"><i class="icon-plus2"></i><i class="icon-cog"></i><i class="icon-minus2"></i></span>').hide().appendTo(this).fadeIn(1e3)}).on("mouseleave",".zTreeItem p",function(){$(this).find(".zTreeControl").remove()}).on("click",".icon-minus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)"),d=b.parent(),e=b.data();c.deleteNode(e,function(){b.fadeOut(500,function(){b.remove(),e.familyName&&c.config.family.push(e.familyName),0===d.find(".zTreeItem").length&&d.remove()})})}).on("click",".icon-cog",function(a){a.stopPropagation();var b=$(this).parent().parent(),d=b.parent(),e=d.data();c.model=e,c.dialog(d);var f=$(".zDialog");f.find(".btnSub").html("Save"),f.find(".zDialogTitle").html('<span class="close">×</span>Edit'),$(".pType").remove(),f.find(".form-control").each(function(){var a=$(this),b=a.attr("name");a.val(e[b])}),null!==e.level&&$(".divGroup").show()}).on("click",".zTreeEdit input, .zTreeEdit i, .zTreeControl",function(a){a.stopPropagation()}).on("click",".icon-plus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)").addClass("active");if(c.model=null,c.parentModel=b.data(),c.dialog(b),b.parent().hasClass("zTreeOrganization")){var d=$('[name="addType"]');d.get(1).checked=!0,$(".pType, .divPerson").hide(),$(".divGroup").show();var e=c.getFamilyString();e?$(".pType").after("<span>Family:</span>"+e[0].outerHTML):(oc.dialog.close(),oc.dialog.tips("No family to add.",3e3))}}).on("dragstart",".zTreeItem[draggable]",function(a){a.stopPropagation(),c.dragEle=$(this)}).on("dragenter",".zTreeItemFolder>p",function(a){a.stopPropagation(),a.preventDefault();var b=$(this),d=b.parent(),e=c.dragEle.data(),f=d.data(),g=e.id,h=f.id;if(!d.parent().hasClass("zTree")&&(h!=g||e.level!=f.level)&&h!=c.dragEle.parents("li:eq(0)").data().id&&d.data().familyName==c.dragEle.data().familyName){var i=d.parents("li"),j=!0;i.each(function(){var a=$(this).data().id;a==g&&(j=!1)}),j&&(d.addClass("treeTag"),c.timer=setTimeout(function(){d.addClass("active")},1e3))}}).on("dragleave",".zTreeItemFolder>p",function(a){c.timer&&clearTimeout(c.timer),a.stopPropagation(),$(this).parent().removeClass("treeTag")}).on("dragover",".zTreeItemFolder.treeTag",function(a){a.preventDefault()}).on("drop",".zTreeItemFolder.treeTag",function(a){var b=$(this),d=c.dragEle.data(),e=b.data(),f=d.id,g=e.id;c.moveNode(f,g,c.dragEle.data().level,function(a,e){if(b.removeClass("treeTag"),a){var f=b.find(">ul");0==f.length&&(f=$("<ul></ul>").appendTo(b)),b.addClass("hasMore");var h=c.dragEle.parents("ul:eq(0)");d.parentId=g,c.dragEle.data(d),c.dragEle.appendTo(f),0===h.find("li").length&&(h.parent().removeClass("hasMore"),h.remove())}else oc.dialog.tips(e)}),a.stopPropagation(),a.preventDefault()})},c.getFamilyString=function(){var a=$('<select class="form-control input-sm" name="family"></select>'),b=c.config.family.length;if(0===b)return null;for(var d=0;b>d;d++)a.append("<option>"+c.config.family[d]+"</option>");return a},c.dialog=function(a){var b='<div class="formOrganization w600 form-inline p10 pl30 pr30"><div class="p15"><p class="pType"><span>Type: </span><label class="mr30"><input type="radio" name="addType" value="person" checked style="margin-right:5px">人员</label><label><input name="addType" style="margin-right:5px" type="radio" value="group">部门</label></p><p class="mt10 divPerson"><span>Name: </span><input type="text" class="form-control input-sm" name="name" autocomplete="off"></p><div class="divGroup none"><p class="mt10"><span>Group name: </span><input type="text" class="form-control input-sm" name="name"></p><p class="mt10"><span>Admin1 name: </span><input type="text" class="form-control input-sm" name="adminUserName" autocomplete="off"></p><p class="mt10"><span>Admin2 name: </span><input type="text" class="form-control input-sm" name="admin2UserName" autocomplete="off"></p></div><p class="divGroup none"><span class="vt">Memo: </span><textarea class="form-control" name="memo"></textarea></p></div><div class="tc pt20" style="border-top:1px solid #ddd;"><button class="btn btn-primary w100 mr20 btnSub">Add</button><button class="btn btn-default w100 ml20" onclick="oc.dialog.close();">Cancel</button></div>';oc.dialog.open("Add",b);var d=$(".zDialog");oc.ui.autoComplete(d.find('.divPerson [name="name"], [name="adminUserName"], [name="admin2UserName"]'),c.config.allUser),d.on("change",'[name="addType"]',function(){"group"===this.value?($(".divGroup").fadeIn(),$(".divPerson").fadeOut()):($(".divPerson").fadeIn(),$(".divGroup").fadeOut())}).on("click",".btnSub",function(){var b=$(this),e=!1;c.model||(e=!0,c.model={familyName:c.parentModel.familyName,parentId:c.parentModel.id});var f=d.find('[name="name"]:visible');if(c.model.name=$.trim(f.val()),!c.model.name)return oc.dialog.tips("Name is required"),void f.focus();var g=$('[name="family"]');if(g.length>0&&(c.model.familyName=g.val()),c.model.memo=$.trim(d.find('[name="memo"]').val()),e){var h=$('[name="addType"]:checked').val();c.model.level=null,"group"==h&&(c.model.level=c.parentModel.level+1)}c.model.adminUserName=$.trim(d.find('[name="adminUserName"]').val()),c.model.admin2UserName=$.trim(d.find('[name="admin2UserName"]').val());var i=b.html();b.html('<i class="zLoadingIcon mr5"></i>'+i+"...").attr("disabled",!0);var j=e?"addNode":"updateNode";c[j](c.model,function(d,f){if(d)if(g.length>0&&(c.config.family=c.config.family.filter(function(a){return a!=c.model.familyName})),oc.dialog.close(),e){var h=a.find(">ul");0===h.length&&(h=$("<ul></ul>").appendTo(a)),c.model.id=f;var k=$('<li class="zTreeItem"><p>'+c.model.name+"</p></li>").data(c.model);null!==c.model.level&&k.addClass("zTreeItemFolder"),0===g.length&&k.attr("draggable","true"),k.appendTo(h),c._setAdmin(a)}else a.data(c.model).find(">p").html(c.model.name),c._setAdmin(a);else b.removeAttr("disabled").html(i),oc.dialog.tips(j+" fail:"+f)})})},c.deleteNode=function(a,b){b()},c.updateNode=function(a,b){setTimeout(b,2e3)},c.addNode=function(a,b){setTimeout(b,2e3)},c.moveNode=function(a,b,c,d){setTimeout(function(){d(!0)},2e3)},c.render()};b.exports=c},{}],11:[function(a,b){var c=function(a){this.config={container:"body",dataList:null,iptClass:"",width:"auto",height:"auto",showAll:!1},this.selectedItem=null,this.selectedList=null,this.ele=null,this.filterParams={},this.valueChangeHanlder=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c._render=function(){c.ele=$('<div class="zTreeSelect"><input type="text" style="width:'+this.config.width+'"></div>'),c.config.iptClass&&c.ele.find("input").addClass(c.config.iptClass),c._renderRecusive(c.config.dataList,c.ele,0),c.ele.appendTo($(c.config.container));var a=c.ele.offset().top,b=$(document).height();c.ele.find(">ul").css("max-height",b-a-150),c._bindEvents(),c.config.showAll&&c.ele.find("input").val("All")},c._selectedP=function(a){if(0!==a.length){var b="";c.selectedItem=a.parent().data(),c.selectedList=[],a.parents(".zTreeSelectItem").each(function(){var a=$(this),d=a.data();c.selectedList.push(d),b=b?d.name+" - "+b:d.name}),c.selectedList.reverse(),c.ele.find("input").val(b).attr("data-id",c.selectedItem.id||""),c.ele.removeClass("active"),"All"===a.html()&&c.ele.find("input").val("All"),c.valueChangeHanlder&&c.valueChangeHanlder()}},c._setActive=function(){var a=c.ele.find(".zTreeSelectItem.active").data();a&&a.id?c.ele.find(".zTreeSelectItem:visible").each(function(b,d){var d=$(d);return d.data().id==a.id?(c.currentActive=b,!1):void 0}):c.currentActive=null},c._bindEvents=function(){c.ele.on("click",function(a){a.stopPropagation(),c.ele.hasClass("active")||(c.ele.addClass("active"),c._setActive(),c.filter(),c.selectedItem&&c.ele.find(".zTreeSelectItem").each(function(){var a=$(this),b=a.data();b==c.selectedItem&&a.find(">p").addClass("active")}))}).on("click","p",function(a){a.stopPropagation();var b=$(this);c._selectedP(b)}).on("input","input",function(){c.ele.find(".zTreeSelectItem.active").removeClass("active"),c._clear(),c.filterParams.name=this.value,c.filter()}).on("mouseenter","li.zTreeSelectItem",function(){c.ele.find(".zTreeSelectItem.active").removeClass("active"),$(this).addClass("active"),c._setActive()}).find("input").on("keyup",function(a){var b=a.keyCode,d=c.ele.find(".zTreeSelectItem.active");if(13===b){var e=d.find(">p");return void c._selectedP(e)}if(40===b||38===b){if(40===b)0==d.length&&(c.currentActive=-1),c.currentActive++;else{if(!c.currentActive)return;c.currentActive--}var f=c.ele.find(".zTreeSelectItem:visible:eq("+c.currentActive+")");if(0!=f.length){c.ele.find(".zTreeSelectItem.active").removeClass("active"),f.addClass("active");var g=c.ele.find(">ul"),h=g.height(),i=f.offset().top,j=g.scrollTop();if(40===b){var k=i-h;k>0&&g.scrollTop(k+j)}else{var k=i-j;100>i&&g.scrollTop(j-32)}}}}),$(document).on("click",function(){c.ele.removeClass("active"),c.selectedItem||(c.filterParams.name=null,c.ele.find("input").val(c.config.showAll?"All":""))})},c._clear=function(){c.selectedItem=null,c.selectedList=[]},c.setSelected=function(a){if(!a)return c.selectedItem=null,c.selectedList=[],c.ele.find("input").val(""),void(c.config.showAll&&c.ele.find("input").val("All"));var b=null;c.selectedList=[];var d="";return c.ele.find("li").each(function(){var e=$(this),f=e.data();return f&&f.id&&f.id==a?(b=e,c.selectedItem=e.data(),c.selectedList.push(c.selectedItem),d=f.name,!1):void 0}),b?(b.parents(".zTreeSelectItem").each(function(){var a=$(this),b=a.data();c.selectedList.push(b),d=b.name+" - "+d}),c.selectedList.reverse(),c.ele.find("input").val(d),c.config.showAll&&""==d&&c.ele.find("input").val("All"),c.selectedList):void 0},c.filter=function(){c.ele.find("li.zTreeSelectItem").removeClass("hidden").show(),c.filterParams&&(c.filterParams&&c.filterParams.description&&c.ele.find('li.zTreeSelectItem[data-level="1"]').addClass("hidden").each(function(){var a=$(this),b=a.data();b.description&&-1===b.description.indexOf(c.filterParams.description)||a.removeClass("hidden")
}),c.filterParams.name&&c.ele.find("li.zTreeSelectItem:visible").hide().each(function(){var a=$(this),b=a.data();b.name&&b.name.toUpperCase().indexOf(c.filterParams.name.toUpperCase())>-1&&(a.show(),a.find("li").show(),a.parents("li.zTreeSelectItem").show())}))},c._renderRecusive=function(a,b,d){if(a){var e=a.length,f=$("<ul></ul>");0===d&&(f.css("max-height",c.config.height),c.config.showAll&&$('<li class="zTreeSelectItem" data-level="0"><p style="padding-left:10px">All</p></li>').appendTo(f));for(var g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeSelectItem" data-level="'+d+'"><p style="padding-left:'+(20*d+10)+'px">'+h.name+"</p></li>");i.appendTo(f).data(h),h.items&&h.items.length>0&&c._renderRecusive(h.items,i,d+1)}e>0&&f.appendTo(b)}},c._render()};b.exports=c},{}],12:[function(require,module,exports){var UI={};UI.toggleBtn=function(a,b){void 0===a&&(a="ON",b="OFF");var c=this;$(".zToggleBtn, .zToggleBtnSm").each(function(){var d=$(this);c.toggleOneBtn(d,a,b)})},UI.toggleOneBtn=function(a,b,c){var d="zToggleBtn";a.removeClass("zToggleBtn"),a.hasClass("zToggleBtnSm")&&(a.removeClass("zToggleBtnSm"),d+=" zToggleBtnSm"),a[0].checked&&(d+=" active");var e=$('<span class="'+d+'"><i class="zToggleBtnON">'+b+'</i><i class="zToggleBtnOFF">'+c+"</i>"+a[0].outerHTML+"</span>");a.replaceWith(e),e.off("change","input").on("change","input",function(){console.log("333"),this.checked?$(this).parents(".zToggleBtn:eq(0)").addClass("active"):$(this).parents(".zToggleBtn:eq(0)").removeClass("active")})},UI.autoComplete=function(ele,array,cb){"function"==typeof array&&(cb=array,array=null),ele.off("keyup").off("keydown").off("blur"),ele.on("keydown",function(a){return console.log("keydow"),13===a.keyCode?(event.preventDefault(),!1):void 0}),ele.on("keyup",function(e){var ipt=$(this),ul=ipt.next("ul.zAutoComplete");if(40!==e.keyCode){if(38===e.keyCode){var focusLi=ul.find("li.active");if(0===focusLi.length)return;var prevLi=focusLi.prev("li");return void(prevLi.length>0&&(prevLi.addClass("active"),focusLi.removeClass("active")))}if(13===e.keyCode){var focusLi=ul.find("li.active");return void(focusLi.length>0&&(ipt.val(focusLi.html()),ul.remove(),cb&&cb(focusLi.html(),ipt)))}var source=array;if(!array){var sourceString=ipt.attr("data-source");source=sourceString?eval(sourceString):ipt.data("source")}if(source){$(".zAutoComplete").remove();var val=$.trim(this.value);if(val){var matchedArray=source.filter(function(a){return a.toUpperCase().indexOf(val.toUpperCase())>-1}),len=matchedArray.length;if(0!==len){len>8&&(len=8);for(var ul=$('<ul class="zAutoComplete"></ul>'),i=0;len>i;i++)ul.append('<li tabindex="0">'+matchedArray[i]+"</li>");var top=ipt.position().top+ipt.outerHeight(),left=ipt.position().left;ul.css({top:top,left:left}).on("click","li",function(){var a=$(this).html();ipt.val(a),$(".zAutoComplete").remove(),cb&&cb(a,ipt)}).on("mouseenter","li",function(){ul.find(".active").removeClass("active"),$(this).addClass("active")}),ipt.after(ul)}}}}else{var focusLi=ul.find("li.active");if(0===focusLi.length)ul.find("li:eq(0)").addClass("active");else{var nextLi=focusLi.next("li");nextLi.length>0&&(nextLi.addClass("active"),focusLi.removeClass("active"))}}}).on("blur",function(){setTimeout(function(){$(".zAutoComplete").remove()},200)})},UI.cbx=function(){return $(".zCbx").off("change","input").on("change","input",function(){this.checked?$(this).parent().addClass("active"):$(this).parent().removeClass("active")}),{check:function(a){if(!a.hasClass("zCbx")){if(0===a.find("input:checkbox").length)return console.warn("zCkb does not contain a input:checkbox item");a.addClass("active").find("input:checkbox")[0].checked=!0}},unCheck:function(a){if(a.hasClass("zCbx")){if(0===a.find("input:checkbox").length)return console.warn("zCkb does not contain a input:checkbox item");a.removeClass("active").find("input:checkbox")[0].checked=!1}}}},UI.multiSelect=function(){$("select.zMultiSelect").each(function(){var a=$(this),b=a.outerWidth(),c=a.outerHeight()+"px",d=a.attr("name");void 0===d&&(d="");var e=$('<div class="zMultiSelect"><div class="zMultiSelectText"></div><div class="zMultiSelectMain"><ul></ul></div></div>');e.css("width",b),e.find(".zMultiSelectText").css({height:c,"line-height":c}).html(a.attr("data-slc"));var f="";a.find("option").each(function(a,b){f+='<li><label class="zCbx"><input type="checkbox", name="'+d+'" value="'+b.value+'">'+b.innerHTML+"</label></li>"}),f+='<li><button class="btnPrimary btnXs" type="button">Confirm</button></li>',e.find("ul").html(f),a.replaceWith(e)}),UI.cbx();var a=function(){var a=$(".zMultiSelect");a.on("click",".zMultiSelectText",function(){var a=$(this).parents(".zMultiSelect:eq(0)");if(a.hasClass("active"))a.removeClass("active").find(".zMultiSelectMain").hide();else{a.addClass("active").find(".zMultiSelectMain").show();var b=this.innerHTML,c=b.split(";");a.find(".zCbx").removeClass("active").find("input:checkbox").attr("checked",!1);for(var d in c){var e=c[d],f=a.find('input:checkbox[value="'+e+'"]');f.length>0&&(f[0].checked=!0,f.parent().addClass("active"))}}}).on("click","button",function(a){var b=$(this).parents(".zMultiSelect:eq(0)"),c=$(this).parents(".zMultiSelectMain:eq(0)"),d="";c.find("input:checked").each(function(){d+=this.value+";"}),d&&(d=d.slice(0,-1)),b.removeClass("active").find(".zMultiSelectText").html(d),c.hide(),a.stopPropagation()}).click(function(a){a.stopPropagation()}),$("html").click(function(){a.removeClass("active").find(".zMultiSelectMain").hide()})};a()},module.exports=UI},{}],13:[function(a,b){var c=function(a){var b=this;this.config={container:"body",maxSize:10,uploadAction:"/upload",postParams:{},blobSize:1e6,callback:null,uploadOneCallback:null},this.STATUS={waiting:0,process:1,success:2,failed:3},this.files=[],this.ele=null,this.msg="",this.queueSize=0,this.uploadedSize=0,this.slice=Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice;for(var c in a)this.config.hasOwnProperty(c)&&(this.config[c]=a[c]);b._renderFoot=function(){var a=$('<div class="zUploaderFoot"></div>');return a.append('<p class="zUploaderStatic">选中0个文件，共0K</p>'),a.append('<span class="zUploaderControl"><span class="zUploaderFileBtn"><input type="file" multiple="multiple" /><span class="zUploaderBtnText">继续添加</span></span><button class="zUploaderBtn" type="button">开始上传</button></span>'),a},b._renderNoFile=function(){var a=$('<div class="zUploaderNoFile"></div>');return a.append('<div class="icon"><i class="icon-images"></i></div>'),a.append('<span class="zUploaderFileBtn "><input type="file" multiple="multiple" /><span class="zUploaderBtnText">点击选择文件</span></div>'),a.append("<p>或将文件拖到这里，单次最多可上传文件"+b.config.maxSize+"个</p>"),a},b._render=function(){b.ele=$('<div class="zUploader"></div>');var a=$('<div class="zUploaderList"></div>');a.append(b._renderNoFile());var c=b._renderFoot().hide();b.ele.append(a),b.ele.append(c),b.ele.appendTo(b.config.container)},b._reloadList=function(){b.ele.find(".zUploaderItem").remove();var a=b.files.length;if(0===a)return b.ele.find(".zUploaderNoFile").show(),void b.ele.find(".zUploaderFoot").hide();b.ele.find(".zUploaderNoFile").hide(),b.ele.find(".zUploaderFoot").show();for(var c=b.ele.find(".zUploaderList"),d=0,e=0;a>e;e++){var f=b.files[e];d+=f.size;var g=b._renderOneFile(f);f.target=g,c.append(g)}b.ele.find(".zUploaderStatic").html("选中"+a+"个文件，共"+(d/1e3).toFixed(2)+"K")},b._pushFiles=function(a){for(var c=0;c<a.length;c++){var d=a[c];if(-1===$.inArray(d,b.files)){if(b.files.length===b.config.maxSize)return alert("超出了最大文件数量"),!1;a[c].status=b.STATUS.waiting,b.files.push(a[c])}}b._reloadList()},b._deleteFile=function(a){return b.files[a].status!==b.STATUS.waiting?alert("改文件当前不允许删除"):(b.files.splice(a,1),void b._reloadList())},b._bindEvent=function(){b.ele.on("change",'.zUploaderFileBtn input[type="file"]',function(){b._pushFiles(this.files)}).on("click",".zUploaderBtn",b._upload).on("click",".zUploaderItemHd i",function(){var a=$(this).index();b._deleteFile(a)}).on("click",".zUploaderReset",function(a){b.files.map(function(c){c.status=b.STATUS.waiting,c.msg="",c.target.find(".zUploaderMsg").removeClass("error").html(""),a.preventDefault()})}),b.ele[0].addEventListener("drop",function(a){a.preventDefault(),b._pushFiles(a.dataTransfer.files)}),$(document).on({dragleave:function(a){a.preventDefault()},drop:function(a){a.preventDefault()},dragenter:function(a){a.preventDefault()},dragover:function(a){a.preventDefault()}})},b._renderOneFile=function(a){var c=$('<div class="zUploaderItem"></div>');c.append('<div class="icon"><i class="icon-images"></i></div>'),c.append('<p class="zUploaderMsg"></p>'),c.append('<div class="zUploaderItemHd"><i class="icon-cross"></i></div>');var d=a.name;if(d.length>25&&(d=d.slice(0,20)+" ..."),c.append('<p class="zUploaderName">'+d+"</p>"),a.status===b.STATUS.success?(c.find(".zUploaderMsg").addClass("ok").html("upload success"),c.find(".zUploaderItemHd").remove()):a.status===b.STATUS.failed&&c.find(".zUploaderMsg").addClass("error").html("upload failed").attr("title",a.msg),/image\/\w+/.test(a.type)){var e=new FileReader;e.onload=function(){var a=e.result;c.find(".icon i").replaceWith('<img src="'+a+'" />')},e.readAsDataURL(a)}return c},b.setStatus=function(a,c){a.status=c,c===b.STATUS.success?(a.target.find(".zUploaderMsg").addClass("ok").html("upload success"),a.target.find(".zUploaderItemHd").remove(),a.status=b.STATUS.success):c===b.STATUS.failed&&(a.target.find(".zUploaderMsg").addClass("error").html("upload failed"),a.status="failed")},b._uploadOneFile=function(a,c){if(b.setStatus(a,b.STATUS.process),window.FormData&&window.XMLHttpRequest)return void b._sendFileByFormData(a,c);var d=(new Date).getTime()+"_"+a.name,e=new FileReader;e.onerror=function(d){b._process(a.size),b.setStatus(a,b.STATUS.failed,"文件读取失败:"+d),c()},e.onload=function(){var f=b.config.postParams;f.fileName=d;var g=e.result,h=function(){return f.fileData=g.slice(0,b.config.blobSize),g=g.slice(b.config.blobSize),0===f.fileData.length?(b.setStatus(a,b.STATUS.success),void c()):(b._process(f.fileData.length),void $.ajax({type:"post",url:b.config.uploadAction,data:f,success:function(){b._process(f.fileData.length),h()},error:function(d){b._process(a.size-g.length),b.setStatus(a,b.STATUS.failed,"文件传输中断:"+d.statusText),c()}}))};h()},e.readAsBinaryString(a)},b._sendFileByFormData=function(a,c){var d=new XMLHttpRequest;d.open("POST",b.config.uploadAction,!0);var e=new FormData;e.append("file",a),d.upload.onload=function(){b._process(a.size),b.setStatus(a,b.STATUS.success),c()},d.upload.onprogress=function(a){b._process(a.loaded,!0)},d.upload.onerror=function(){b._process(a.size),b.setStatus(a,b.STATUS.failed,"文件传输中断:"+res.statusText),c()},d.onreadystatechange=function(){4==d.readyState&&200==d.status&&(a.response=d.response)},d.send(e)},b._process=function(a,c){var d=b.ele.find(".zUploaderStatic"),e=d.find(".zUploaderProcess");0===e.length&&(d.html(""),e=$('<span class="zUploaderProcess"><span class="zUploaderProcessInner"></span></span>').appendTo(d),eleProcesText=$('<span class="zUploaderProcessText"></span>').appendTo(d));var f=b.uploadedSize+a;0!==a&&e.attr("data-count",f).find(".zUploaderProcessInner").css("width",100*f/b.queueSize+"%"),d.find(".zUploaderProcessText").html("( "+(f/1e3).toFixed(2)+" KB / "+(b.queueSize/1e3).toFixed(2)+" KB )"),c!==!0&&(b.uploadedSize+=a)},b._upload=function(){var a=b.files.filter(function(a){return a.status===b.STATUS.process});if(a.length>0)return alert("有文件正在上传，请稍后...");b.queueSize=0,b.uploadedSize=0;var c=b.files.filter(function(a){return a.status===b.STATUS.waiting?(b.queueSize+=a.size,!0):!1});b.queueSize>1e7&&(b.config.blobSize=4e6),b._process(0);var d=0,e=function(){return d===c.length?(b._setFootStatics(),void(b.config.callback&&b.config.callback(b.files))):void b._uploadOneFile(c[d],function(){b.config.uploadOneCallback&&b.config.uploadOneCallback(c[d]),e(d++)})};e()},b._setFootStatics=function(){var a=b.files.filter(function(a){return a.status==b.STATUS.success}),c=a.length,d=b.files.length-c,e="已成功上传"+c+"个文件";d>0&&(e+="，"+d+'个文件上传失败，<a class="zUploaderReset" href="#">重置失败文件？</a>'),b.ele.find(".zUploaderStatic").html(e)},b._render(),b._bindEvent()};b.exports=c},{}]},{},[5]);