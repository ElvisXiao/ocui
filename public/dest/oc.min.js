/*! Tinyp2p 2015-02-13 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){!function(a){"use strict";function c(a,b){var c=b.toString(),d=c.substring(1,c.lastIndexOf("/")),e=c.substring(c.lastIndexOf("/")+1);return-1===e.indexOf("g")&&(b=new RegExp(d,e+"g")),a.split(b)}function d(a){return""===a.replace(/^[\s]*|[\s]*$/g,"")}function e(a){var b;for(b=0;b<a.length;b++)d(a[b])&&a.splice(b--,1)}function f(a,b){var c,d,e,f;for(c=0;c<a.length;c++)if(e=a[c].replace(/^[\s]*|[\s]*$/g,""),f="",('"'===e.charAt(0)||"'"===e.charAt(0))&&(f=e.charAt(0)),""!==f&&e.slice(-1)!==f){for(d=c+1,d<a.length&&(e=a[d].replace(/^[\s]*|[\s]*$/g,""));d<a.length&&e.slice(-1)!==f;)a[c]+=b+a.splice(d,1)[0],e=a[d].replace(/[\s]*$/g,"");d<a.length&&(a[c]+=b+a.splice(d,1)[0])}}function g(a){var b;for(b=0;b<a.length;b++)a[b]=a[b].replace(/^[\s]*|[\s]*$/g,"")}function h(a){var b;for(b=0;b<a.length;b++)'"'===a[b].charAt(0)?a[b]=a[b].replace(/^"|"$/g,""):"'"===a[b].charAt(0)&&(a[b]=a[b].replace(/^'|'$/g,""))}function i(a,b){var c=a.split(b);return f(c,b),g(c),h(c),c}function j(a,b){var c,d=[];for(c=0;c<a.length;c++)d[c]=i(a[c],b);return d}function k(a){var b,c,d,e,f,g=[],h=a[0];for(b=1;b<a.length;b++)if(d=a[b],d.length>0){if(d.length>h.length)throw new SyntaxError("not enough header fields");for(e={},c=0;c<h.length;c++)f=h[c],e[f]=c<d.length?d[c]:"";g.push(e)}return g}var l={};l.parse=function(a,b,d,f){var g,h,i,l={lineEnding:/[\r\n]/,delimiter:",",ignoreEmptyLines:!0};if(""===a)throw new SyntaxError("empty input");if("undefined"!=typeof b&&(l.lineEnding=b instanceof RegExp?b:new RegExp("["+String(b)+"]","g")),"undefined"!=typeof d&&(l.delimiter=String(d)),"undefined"!=typeof f&&(l.ignoreEmptyLines=!!f),g=c(a,l.lineEnding),l.ignoreEmptyLines&&e(g),g.length<2)throw new SyntaxError("missing header");return h=j(g,l.delimiter),i=k(h)},"object"==typeof b&&b&&"object"==typeof b.exports?b.exports=l:"function"==typeof define&&define.amd?define([],function(){return l}):a.CSV=l}("undefined"!=typeof window?window:{})},{}],2:[function(a,b){var c={};c.tips=function(a,b,c){this.removeAllTips(),void 0===b&&(b=1500);var d=$('<div class="tips">'+a+"</div>");d.appendTo("body");var e=d.width();d.css("margin-left",-e/2+"px"),setTimeout(function(){d.remove(),c&&c()},b)},c.loading=function(a){this.removeAllTips();var b=$('<div class="zLoading"></div><div class="tips">'+a+"</div>");b.appendTo("body");var c=$(".tips").width();return b.css("margin-left",-c/2+"px"),b},c.confirm=function(a,b,c){this.removeMadal();var d=$('<div class="zLoading"></div><div class="tips confirm w500">'+a+'<div style="border-top: 1px dashed #ddd;" class="tc mt20 pt10"><button class="btn btn-info btn-sm btnOK mr20">确定</button><button class="btn btn-default btn-sm btnCancel" style="margin-right: 0">取消</button></div></div>');d.appendTo("body").on("click",".btnOK, .btnCancel",function(){var a=d.find("input"),e="";a.length>0&&(e=a.val()),d.remove(),$(this).hasClass("btnOK")?b&&b(e):c&&c(e)}).on("click","input",function(){d.removeClass("has-error")});var e=$(".tips").width();return d.css("margin-left",-e/2+"px"),d},c.open=function(a,b){this.removeAllTips(),b||(b=a,a="");var c=$('<div class="zDialogCover"><div class="zDialog"><p class="zDialogTitle"><span class="close">×</span>'+a+"</p>"+b+"</div></div>").appendTo(document.body),d=c.find(".zDialog"),e=d.outerWidth(),f=d.outerHeight();d.css({"margin-left":-e/2+"px",left:"50%"});var g=$(document).outerHeight();d.on("click",".close",function(){d.animate({top:0,opacity:0},500,function(){c.remove()})});var h="20%";f>g&&(h="5%"),d.animate({top:h,opacity:1},500)},c.close=function(){var a=$(".zDialogCover");if(a.length){var b=a.find(".zDialog");b.animate({top:0,opacity:0},500,function(){a.remove()})}},b.exports=c},{}],3:[function(a,b){var c=function(b){this.csv=a("./asset/csv"),this.ele=null,this._dataList=[],this.canEdit=!0,this.maxHeight=800,this.config={container:"body",canEdit:!0,maxHeight:800,heads:[]};for(var c in b)this.config.hasOwnProperty(c)&&(this.config[c]=b[c]);var d=this;d._render=function(){d.ele=$('<div class="zUploader"></div>');var a=$('<div class="zUploaderList"></div>');a.append(d._renderNoFile()),d.ele.append(a),d.ele.appendTo(d.config.container)},d._renderNoFile=function(){var a=$('<div class="zUploaderNoFile" style="padding:15px 0 0 0;"></div>');return a.append('<span class="zUploaderFileBtn "><input type="file" accept=".csv" /><span class="zUploaderBtnText">点击选择文件</span></div>'),a.append("<p>或将文件拖到这里, 暂仅支持CSV格式</p>"),a},d._bindEvent=function(){d.ele.on("change",'.zUploaderFileBtn input[type="file"]',function(){d._readFilesToTable(this.files[0])}),d.ele.find(".zUploaderNoFile")[0].addEventListener("drop",function(a){$(this).css("border","3px dashed #e6e6e6"),a.preventDefault(),d._readFilesToTable(a.dataTransfer.files[0])}),d.ele.on("dragenter",".zUploaderNoFile",function(a){a.preventDefault(),$(this).css("border","3px dashed #aaa")}).on("dragleave",".zUploaderNoFile",function(a){a.preventDefault(),$(this).css("border","3px dashed #e6e6e6")}),$(document).on({dragleave:function(a){a.preventDefault()},drop:function(a){a.preventDefault()},dragenter:function(a){a.preventDefault()},dragover:function(a){a.preventDefault()}}),d.ele.on("blur",".zFileTable tbody td input",function(){var a=this.value,b=$(this),c=b.parent(),e=c.attr("data-index"),f=e.split(","),g=f[0],h=f[1];d._dataList[g][h]=a})},d.readCsv=function(a,b){var c=new FileReader;c.onload=function(){$('input[type="file"]').replaceWith($('<input type="file" accept=".csv">'));var a=c.result;d._formatFileContent(a),b()},c.readAsText(a)},d._formatFileContent=function(a){var b=d.csv.parse(a),c=b[0],e=[];for(var f in c)e.push(f);d._dataList=[],d._dataList.push(e);for(var g=0;g<b.length;g++){var h=b[g],i=[];for(var f in h)i.push(h[f]);d._dataList.push(i)}},d._readFilesToTable=function(a){d.readCsv(a,function(){$(".zFileTableContainer").remove();var a=$('<div class="zFileTableContainer"><table class="zFileTable"></table></div>');d.config.maxHeight&&a.css("max-height",d.config.maxHeight+"px");var b=a.find(".zFileTable");if(d._dataList&&d._dataList.length>0){for(var c=d._dataList[0],e=c.length,f=$("<thead></thead>"),g=$("<tbody></tbody>"),h=$("<tr><th></th></tr>").appendTo(f),i=0;e>i;i++)h.append("<th>"+c[i]+"</th>");for(var i=1;i<d._dataList.length;i++){for(var j=d._dataList[i],k=$("<tr><td>"+i+"</td></tr>"),l=0;e>l;l++)k.append('<td data-val="true", data-index="'+i+","+l+'">'+$.trim(j[l])+"</td>");g.append(k)}b.append(f),b.append(g)}var m=d.ele.find(".zUploaderList");m.find(".zFileTable").remove(),a.appendTo(m),d.setEditTable(b)})},d.setEditTable=function(a){d.config.canEdit===!0&&a.find("tbody td[data-val]").each(function(){var a=$(this),b=a.html();a.html('<span class="tdSpan">'+b+'</span><input class="tdIpt" type="text" value="'+b+'" />')})},d.getDataList=function(){var a=[];if(!d._dataList||0===d._dataList.length)return null;var b=d._dataList[0];d.config.heads&&d.config.heads.length>0&&(d.config.heads.length>b.length&&(d.config.heads=d.config.heads.slice(0,b.length)),b=b.slice(d.config.heads.length),b=d.config.heads.concat(b));for(var c=b.length,e=1;e<d._dataList.length;e++){for(var f=d._dataList[e],g={},h=0;c>h;h++)g[b[h]]=$.trim(f[h]);a.push(g)}return a},d.mark=function(a){for(var b=a.length,c=0;b>c;c++){var e=a[c],f=e.row+","+e.col,g=d.ele.find('tbody td[data-index="'+f+'"]');g.addClass("zFileTableMark").attr("title",e.msg)}},d.clearMark=function(){d.ele.find("tbody .zFileTableMark").removeAttr("title").removeClass("zFileTableMark")},d._render(),d._bindEvent()};b.exports=c},{"./asset/csv":1}],4:[function(a){!function(){window.oc={},oc.ui=a("./ui"),oc.dialog=a("./dialog"),oc.localSorage=a("./localStorage"),oc.FileView=a("./fileView"),oc.Uploader=a("./uploader"),oc.TreeSelect=a("./treeSelect"),oc.Tree=a("./tree");var b=$("script[data-occss]").attr("data-occss");b?$("<link>").attr({rel:"stylesheet",type:"text/css",href:b}).appendTo("head"):$("<link>").attr({rel:"stylesheet",type:"text/css",href:"/product/js/oc/oc.css"}).appendTo("head")}()},{"./dialog":2,"./fileView":3,"./localStorage":5,"./tree":6,"./treeSelect":7,"./ui":8,"./uploader":9}],5:[function(a,b){var c={storage:window.localStorage};c.set=function(a,b){if("string"!=typeof a)return void console.error("key mast to be a string");var c=JSON.stringify(b);this.storage.key=c},c.get=function(a){if("string"!=typeof a)return console.error("key mast to be a string"),null;var b=this.storage[a]||null,c=JSON.parse(b);return c},c.remove=function(a){this.storage.removeItem(a)},c.clear=function(){this.storage.clear()},b.exports=c},{}],6:[function(a,b){var c=function(a){this.config={container:"body",data:null,showLevel:1},this.ele=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c.render=function(){c.ele=$('<ul class="zTree"></ul>');var a=$('<li class="zTreeItem"><p>'+c.config.data.name+"</p></li>").data(c.config.data);a.appendTo(c.ele),c._renderRecusive(c.config.data.items,a,0),c.ele.appendTo($(this.config.container)),c._bindEvents()},c._renderRecusive=function(a,b,d){var e=a.length;e>0&&b.addClass("hasMore"),d<this.config.showLevel&&b.addClass("active");for(var f=$("<ul></ul>"),g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeItem"><p>'+h.name+"</p></li>");h.description&&i.addClass("zTreeItemDes").find(">p").attr("title",h.description),i.appendTo(f).data(h),h.items&&h.items.length>0&&c._renderRecusive(h.items,i,d+1)}e>0&&f.appendTo(b)},c._bindEvents=function(){c.ele.on("click",".zTreeItem p",function(){$(this).parent().toggleClass("active")}).on("mouseenter",".zTreeItem p",function(){$('<span class="zTreeControl"><i class="icon-plus2"></i><i class="icon-cog"></i><i class="icon-minus2"></i></span>').hide().appendTo(this).fadeIn(1e3)}).on("mouseleave",".zTreeItem p",function(){$(this).find(".zTreeControl").remove()}).on("click",".icon-minus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)"),d=b.parent(),e=b.data();if(!e||!e.id)return void b.fadeOut(500,function(){b.remove(),0===d.find(".zTreeItem").length&&d.remove()});var f=b.data().id;c.deleteNode(f,function(){b.fadeOut(500,function(){b.remove(),0===d.find(".zTreeItem").length&&d.remove()})})}).on("click",".icon-cog",function(a){a.stopPropagation();var b=$(this).parent().parent();b.addClass("zTreeEdit"),b.html('<input type="text" name="name"><input type="text" name="description"><i class="iconRight icon-checkmark"></i>');var c=b.parent().data();b.find('[name="name"]').val(c.name),b.find('[name="description"]').val(c.description)}).on("click",".zTreeEdit input, .zTreeEdit i, .zTreeControl",function(a){a.stopPropagation()}).on("click",".icon-checkmark",function(a){a.stopPropagation();var b=$(this);b.removeClass("icon-checkmark").addClass("zLoadingIcon");var d=b.parents(".zTreeItem:eq(0)").removeClass("zTreeItemDes"),e=d.data();e&&e.id||(e={},e.fid=d.parents(".zTreeItem:eq(0)").data().id),e.name=d.find('[name="name"]').val(),e.description=d.find('[name="description"]').val();var f=function(a){return a===!1?void b.removeClass("zLoadingIcon").addClass("icon-checkmark"):(d.parents(".zTreeItem").addClass("hasMore"),d.data(e).find(">p").html(e.name).removeClass("zTreeEdit"),void(e.description&&d.addClass("zTreeItemDes").find("p").attr("title",e.description)))};e.id?c.updateNode(e,f):c.addNode(e,f)}).on("click",".icon-plus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)").addClass("active"),c=b.find(">ul");0===c.length&&(c=$("<ul></ul>").appendTo(b));var d=$('<li class="zTreeItem"></li>');d.append('<p class="zTreeEdit"><input type="text" name="name"><input type="text" name="description"><i class="iconRight icon-checkmark"></i></p>'),d.appendTo(c)})},c.deleteNode=function(a,b){b()},c.updateNode=function(a,b){setTimeout(b,2e3)},c.addNode=function(a,b){setTimeout(b,2e3)},c.render()};b.exports=c},{}],7:[function(a,b){var c=function(a){this.config={container:"body",dataList:null,iptClass:"",width:"auto",height:"auto",showAll:!1},this.selectedItem=null,this.selectedList=null,this.ele=null,this.filterParams={};for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c._render=function(){c.ele=$('<div class="zTreeSelect"><input type="text" style="width:'+this.config.width+'"></div>'),c.config.iptClass&&c.ele.find("input").addClass(c.config.iptClass),c._renderRecusive(c.config.dataList,c.ele,0),c.ele.appendTo($(c.config.container)),c._bindEvents(),c.config.showAll&&c.ele.find("input").val("All")},c._bindEvents=function(){c.ele.on("click",function(a){a.stopPropagation(),c.ele.hasClass("active")||(c.ele.addClass("active"),c.filter(),c.selectedItem&&c.ele.find(".zTreeSelectItem").each(function(){var a=$(this),b=a.data();b==c.selectedItem&&a.find(">p").addClass("active")}))}).on("click","p",function(a){a.stopPropagation();var b=$(this),d="";c.selectedItem=b.parent().data(),c.selectedList=[],b.parents(".zTreeSelectItem").each(function(){var a=$(this),b=a.data();c.selectedList.push(b),d=d?b.name+" - "+d:b.name}),c.selectedList.reverse(),c.ele.find("input").val(d).attr("data-id",c.selectedItem.id||""),c.ele.removeClass("active"),"All"===b.html()&&c.ele.find("input").val("All")}).on("input","input",function(){c._clear(),c.filterParams.name=this.value,c.filter()}),$(document).on("click",function(){c.ele.removeClass("active"),c.selectedItem||(c.filterParams.name=null,c.ele.find("input").val(""))})},c._clear=function(){c.selectedItem=null,c.selectedList=[]},c.setSelected=function(a){if(!a)return c.selectedItem=null,c.selectedList=[],c.ele.find("input").val(""),void(c.config.showAll&&c.ele.find("input").val("All"));var b=null;c.selectedList=[];var d="";return c.ele.find("li").each(function(){var e=$(this),f=e.data();return f&&f.id&&f.id===a?(b=e,c.selectedItem=e.data(),c.selectedList.push(c.selectedItem),d=f.name,!1):void 0}),b?(b.parents(".zTreeSelectItem").each(function(){var a=$(this),b=a.data();c.selectedList.push(b),d=b.name+" - "+d}),c.selectedList.reverse(),c.ele.find("input").val(d),c.config.showAll&&""==d&&c.ele.find("input").val("All"),c.selectedList):void 0},c.filter=function(){c.ele.find("li.zTreeSelectItem").hide().each(function(){var a=$(this),b=a.data(),d=!0;for(var e in c.filterParams){var f=c.filterParams[e];if(f){f=f.toUpperCase();var g=b[e];if(!g){d=!1;break}if(g=g.toString().toUpperCase(),-1===g.indexOf(f)){d=!1;break}}}d===!0&&(a.show(),a.parents("li.zTreeSelectItem").show())})},c._renderRecusive=function(a,b,d){var e=a.length,f=$("<ul></ul>");0===d&&(f.css("max-height",c.config.height),c.config.showAll&&$('<li class="zTreeSelectItem"><p data-level="0" style="padding-left:10px">All</p></li>').appendTo(f));for(var g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeSelectItem"><p data-level="'+d+'" style="padding-left:'+(20*d+10)+'px">'+h.name+"</p></li>");i.appendTo(f).data(h),h.items&&h.items.length>0&&c._renderRecusive(h.items,i,d+1)}e>0&&f.appendTo(b)},c._render()};b.exports=c},{}],8:[function(require,module,exports){var UI={};UI.toggleBtn=function(){$(".zToggleBtn").each(function(){var a=$(this).removeClass("zToggleBtn"),b=$('<span class="zToggleBtn"><i class="zToggleBtnON">ON</i><i class="zToggleBtnOFF">OFF</i>'+a[0].outerHTML+"</span>");a.replaceWith(b)}),$(".zToggleBtn").off("change","input").on("change","input",function(){this.checked?$(this).parents(".zToggleBtn:eq(0)").addClass("active"):$(this).parents(".zToggleBtn:eq(0)").removeClass("active")})},UI.autoComplete=function(ele,array,cb){"function"==typeof array&&(cb=array,array=null),ele.off("keyup").off("keydown").off("blur"),ele.on("keydown",function(a){return 13===a.keyCode?(event.preventDefault(),!1):void 0}),ele.on("keyup",function(e){var ipt=$(this);if(13===e.keyCode){var val=$(".zAutoComplete li.active").html();return val&&(ipt.val(val),$(".zAutoComplete").remove()),event.preventDefault(),!1}var source=array;if(!array){var sourceString=ipt.attr("data-source");source=sourceString?eval(sourceString):ipt.data("source")}if(source){$(".zAutoComplete").remove();var val=$.trim(this.value);if(val){var matchedArray=source.filter(function(a){return a.toUpperCase().indexOf(val.toUpperCase())>-1}),len=matchedArray.length;if(0!==len){len>8&&(len=8);for(var ul=$('<ul class="zAutoComplete"></ul>'),i=0;len>i;i++)ul.append("<li>"+matchedArray[i]+"</li>");var top=ipt.offset().top+ipt.outerHeight(),left=ipt.offset().left;ul.css({top:top,left:left}).on("click","li",function(){var a=$(this).html();ipt.val(a),$(".zAutoComplete").remove(),cb&&cb(a)}).on("mouseenter","li",function(){ul.find(".active").removeClass("active"),$(this).addClass("active")}),ipt.after(ul)}}}}).on("blur",function(){setTimeout(function(){$(".zAutoComplete").remove()},200)})},module.exports=UI},{}],9:[function(a,b){var c=function(a){var b=this;this.config={container:"body",maxSize:10,uploadAction:"/upload",postParams:{},blobSize:1e6},this.STATUS={waiting:0,process:1,success:2,failed:3},this.files=[],this.ele=null,this.msg="",this.queueSize=0,this.uploadedSize=0,this.slice=Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice;for(var c in a)this.config.hasOwnProperty(c)&&(this.config[c]=a[c]);b._renderFoot=function(){var a=$('<div class="zUploaderFoot"></div>');return a.append('<p class="zUploaderStatic">选中0个文件，共0K</p>'),a.append('<span class="zUploaderControl"><span class="zUploaderFileBtn"><input type="file" multiple="multiple" /><span class="zUploaderBtnText">继续添加</span></span><button class="zUploaderBtn" type="button">开始上传</button></span>'),a},b._renderNoFile=function(){var a=$('<div class="zUploaderNoFile"></div>');return a.append('<div class="icon"><i class="icon-images"></i></div>'),a.append('<span class="zUploaderFileBtn "><input type="file" multiple="multiple" /><span class="zUploaderBtnText">点击选择文件</span></div>'),a.append("<p>或将文件拖到这里，单次最多可上传文件"+b.config.maxSize+"个</p>"),a},b._render=function(){b.ele=$('<div class="zUploader"></div>');var a=$('<div class="zUploaderList"></div>');a.append(b._renderNoFile());var c=b._renderFoot().hide();b.ele.append(a),b.ele.append(c),b.ele.appendTo(b.config.container)},b._reloadList=function(){b.ele.find(".zUploaderItem").remove();var a=b.files.length;if(0===a)return b.ele.find(".zUploaderNoFile").show(),void b.ele.find(".zUploaderFoot").hide();b.ele.find(".zUploaderNoFile").hide(),b.ele.find(".zUploaderFoot").show();for(var c=b.ele.find(".zUploaderList"),d=0,e=0;a>e;e++){var f=b.files[e];d+=f.size;var g=b._renderOneFile(f);f.target=g,c.append(g)}b.ele.find(".zUploaderStatic").html("选中"+a+"个文件，共"+(d/1e3).toFixed(2)+"K")},b._pushFiles=function(a){for(var c=0;c<a.length;c++){var d=a[c];if(-1===$.inArray(d,b.files)){if(b.files.length===b.config.maxSize)return alert("超出了最大文件数量"),!1;a[c].status=b.STATUS.waiting,b.files.push(a[c])}}b._reloadList()},b._deleteFile=function(a){return b.files[a].status!==b.STATUS.waiting?alert("改文件当前不允许删除"):(b.files.splice(a,1),void b._reloadList())},b._bindEvent=function(){b.ele.on("change",'.zUploaderFileBtn input[type="file"]',function(){b._pushFiles(this.files)}).on("click",".zUploaderBtn",b._upload).on("click",".zUploaderItemHd i",function(){var a=$(this).index();b._deleteFile(a)}).on("click",".zUploaderReset",function(a){b.files.map(function(c){c.status=b.STATUS.waiting,c.msg="",c.target.find(".zUploaderMsg").removeClass("error").html(""),a.preventDefault()})}),b.ele[0].addEventListener("drop",function(a){a.preventDefault(),b._pushFiles(a.dataTransfer.files)}),$(document).on({dragleave:function(a){a.preventDefault()},drop:function(a){a.preventDefault()},dragenter:function(a){a.preventDefault()},dragover:function(a){a.preventDefault()}})},b._renderOneFile=function(a){var c=$('<div class="zUploaderItem"></div>');c.append('<div class="icon"><i class="icon-images"></i></div>'),c.append('<p class="zUploaderMsg"></p>'),c.append('<div class="zUploaderItemHd"><i class="icon-cross"></i></div>');var d=a.name;if(d.length>25&&(d=d.slice(0,20)+" ..."),c.append('<p class="zUploaderName">'+d+"</p>"),a.status===b.STATUS.success?(c.find(".zUploaderMsg").addClass("ok").html("upload success"),c.find(".zUploaderItemHd").remove()):a.status===b.STATUS.failed&&c.find(".zUploaderMsg").addClass("error").html("upload failed").attr("title",a.msg),/image\/\w+/.test(a.type)){var e=new FileReader;e.onload=function(){var a=e.result;c.find(".icon i").replaceWith('<img src="'+a+'" />')},e.readAsDataURL(a)}return c},b.setStatus=function(a,c){a.status=c,c===b.STATUS.success?(a.target.find(".zUploaderMsg").addClass("ok").html("upload success"),a.target.find(".zUploaderItemHd").remove(),a.status=b.STATUS.success):c===b.STATUS.failed&&(a.target.find(".zUploaderMsg").addClass("error").html("upload failed"),a.status="failed")},b._uploadOneFile=function(a,c){if(b.setStatus(a,b.STATUS.process),window.FormData&&window.XMLHttpRequest)return void b._sendFileByFormData(a,c);var d=(new Date).getTime()+"_"+a.name,e=new FileReader;e.onerror=function(d){b._process(a.size),b.setStatus(a,b.STATUS.failed,"文件读取失败:"+d),c()},e.onload=function(){var f=b.config.postParams;f.fileName=d;var g=e.result,h=function(){return f.fileData=g.slice(0,b.config.blobSize),g=g.slice(b.config.blobSize),0===f.fileData.length?(b.setStatus(a,b.STATUS.success),void c()):(b._process(f.fileData.length),void $.ajax({type:"post",url:b.config.uploadAction,data:f,success:function(){b._process(f.fileData.length),h()},error:function(d){b._process(a.size-g.length),b.setStatus(a,b.STATUS.failed,"文件传输中断:"+d.statusText),c()}}))};h()},e.readAsBinaryString(a)},b._sendFileByFormData=function(a,c){var d=new XMLHttpRequest;d.open("POST",b.config.uploadAction,!0);var e=new FormData;e.append("file",a),d.upload.onload=function(){b._process(a.size),b.setStatus(a,b.STATUS.success),c()},d.upload.onprogress=function(a){b._process(a.loaded,!0)},d.upload.onerror=function(){b._process(a.size),b.setStatus(a,b.STATUS.failed,"文件传输中断:"+res.statusText),c()},d.send(e)},b._process=function(a,c){var d=b.ele.find(".zUploaderStatic"),e=d.find(".zUploaderProcess");0===e.length&&(d.html(""),e=$('<span class="zUploaderProcess"><span class="zUploaderProcessInner"></span></span>').appendTo(d),eleProcesText=$('<span class="zUploaderProcessText"></span>').appendTo(d));var f=b.uploadedSize+a;0!==a&&e.attr("data-count",f).find(".zUploaderProcessInner").css("width",100*f/b.queueSize+"%"),d.find(".zUploaderProcessText").html("( "+(f/1e3).toFixed(2)+" KB / "+(b.queueSize/1e3).toFixed(2)+" KB )"),c!==!0&&(b.uploadedSize+=a)},b._upload=function(){var a=b.files.filter(function(a){return a.status===b.STATUS.process});if(a.length>0)return alert("有文件正在上传，请稍后...");b.queueSize=0,b.uploadedSize=0;var c=b.files.filter(function(a){return a.status===b.STATUS.waiting?(b.queueSize+=a.size,!0):!1});b.queueSize>1e7&&(b.config.blobSize=4e6),b._process(0);var d=0,e=function(){return d===c.length?void b._setFootStatics():void b._uploadOneFile(c[d],function(){e(d++)})};e()},b._setFootStatics=function(){var a=b.files.filter(function(a){return a.status==b.STATUS.success}),c=a.length,d=b.files.length-c,e="已成功上传"+c+"个文件";d>0&&(e+="，"+d+'个文件上传失败，<a class="zUploaderReset" href="#">重置失败文件？</a>'),b.ele.find(".zUploaderStatic").html(e)},b._render(),b._bindEvent()};b.exports=c},{}]},{},[4]);